/**
 * skylark-utils-math - The math features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,n){function r(t,n){if("."!==t[0])return t;var r=n.split("/"),e=t.split("/");r.pop();for(var i=0;i<e.length;i++)"."!=e[i]&&(".."==e[i]?r.pop():r.push(e[i]));return r.join("/")}var e=n.define,i=n.require,s="function"==typeof e&&e.amd,o=!s&&"undefined"!=typeof exports;if(!s&&!e){var a={};e=n.define=function(t,n,e){"function"==typeof e?(a[t]={factory:e,deps:n.map(function(n){return r(n,t)}),exports:null},i(t)):a[t]=e},i=n.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=a[t];if(!n.exports){var r=[];n.deps.forEach(function(t){r.push(i(t))}),n.exports=n.factory.apply(window,r)}return n.exports}}if(!e)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(e,i),!s){var u=i("skylark-langx/skylark");o?exports=u:n.skylarkjs=u}}(function(define,require){define("skylark-langx/skylark",[],function(){var t={};return t}),define("skylark-utils/skylark",["skylark-langx/skylark"],function(t){return t}),define("skylark-langx/types",[],function(){function t(t){return t&&t.constructor===Array}function n(t){return!l(t)&&!a(t)&&"number"==typeof t.length&&!o(t)}function r(t){return"boolean"==typeof t}function e(t){return"undefined"!=typeof t}function i(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE}function s(t){var n;for(n in t)if(null!==t[n])return!1;return!0}function o(t){return"function"==d(t)}function a(t){return t&&t instanceof Node}function u(t){return"number"==typeof t}function h(t){return"object"==d(t)}function c(t){return h(t)&&!f(t)&&Object.getPrototypeOf(t)==Object.prototype}function l(t){return"string"==typeof t}function f(t){return t&&t==t.window}function p(t){if(t){var n=location.protocol+"//"+location.hostname;return location.port&&(n+=":"+location.port),t.startsWith(n)}}var d=function(){var t={};return"Boolean Number String Function Array Date RegExp Object Error".split(" ").forEach(function(n){t["[object "+n+"]"]=n.toLowerCase()}),function(n){return null==n?String(n):t[toString.call(n)]||"object"}}();return{isArray:t,isArrayLike:n,isBoolean:r,isDefined:e,isDocument:i,isEmptyObject:s,isFunction:o,isHtmlNode:a,isNumber:u,isObject:h,isPlainObject:c,isString:l,isSameOrigin:p,isWindow:f,type:d}}),define("skylark-langx/arrays",["./types"],function(t){function n(t){return u.call(t,function(t){return null!=t})}function r(t,n){var r,e,i,s,o;if(t)if(r=t.length,r===s){for(e in t)if(t.hasOwnProperty(e)&&(o=t[e],n.call(o,e,o)===!1))break}else for(i=0;i<r&&(o=t[i],n.call(o,i,o)!==!1);i++);return this}function e(t){if(h(t)){for(var n=[],r=0;r<t.length;r++){var e=t[r];if(h(e))for(var i=0;i<e.length;i++)n.push(e[i]);else n.push(e)}return n}return t}function i(t,n){if(!n)return-1;var r;if(n.indexOf)return n.indexOf(t);for(r=n.length;r--;)if(n[r]===t)return r;return-1}function s(t,n,r){return h(t)?(r||[]).concat(Array.prototype.slice.call(t,n||0)):[t]}function o(t,n){var r,i,s,o=[];if(h(t))for(i=0;i<t.length;i++)r=n.call(t[i],t[i],i),null!=r&&o.push(r);else for(s in t)r=n.call(t[s],t[s],s),null!=r&&o.push(r);return e(o)}function a(t){return u.call(t,function(n,r){return t.indexOf(n)==r})}var u=Array.prototype.filter,h=t.isArrayLike;return{compact:n,first:function(t,n){return n?t.slice(0,n):t[0]},each:r,flatten:e,inArray:i,makeArray:s,map:o,uniq:a}}),define("skylark-langx/objects",["./types"],function(t){function n(t,n){return function(r){var e=arguments.length;if(n&&(r=Object(r)),e<2||null==r)return r;for(var i=1;i<e;i++)for(var s=arguments[i],o=t(s),a=o.length,u=0;u<a;u++){var h=o[u];n&&void 0!==r[h]||(r[h]=s[h])}return r}}function r(t){if(!k(t))return[];var n=[];for(var r in t)n.push(r);return n}function e(t){if(k(t))return[];var n=[];for(var r in t)i(t,r)&&n.push(r);return n}function i(t,n){if(!T(n))return null!=t&&v.call(t,n);for(var r=n.length,e=0;e<r;e++){var i=n[e];if(null==t||!v.call(t,i))return!1;t=t[i]}return!!r}function s(t,n){return y(t,n)}function o(t,n){var r=r(n),e=r.length;if(null==t)return!e;for(var i=Object(t),s=0;s<e;s++){var o=r[s];if(n[o]!==i[o]||!(o in i))return!1}return!0}function a(t,n,r,e){for(var i in n)e&&void 0!==t[i]||(r&&(b(n[i])||T(n[i]))?(b(n[i])&&!b(t[i])&&(t[i]={}),T(n[i])&&!T(t[i])&&(t[i]=[]),a(t[i],n[i],r,e)):void 0!==n[i]&&(t[i]=n[i]));return t}function u(t){var n=x.call(arguments,0),r=n.shift(),e=!1;return g(n[n.length-1])&&(e=n.pop()),{target:r,sources:n,deep:e}}function h(){var t=u.apply(this,arguments);return t.sources.forEach(function(n){a(t.target,n,t.deep,!1)}),t.target}function c(t,n){if(T(t)){var r=t.indexOf(n);r!=-1&&t.splice(r,1)}else if(b(t))for(var e in t)if(t[e]==n){delete t[e];break}return this}function l(t,n,r){T(n)||(n=[n]);var e=n.length;if(!e)return w(r)?r.call(t):r;for(var i=0;i<e;i++){var s=null==t?void 0:t[n[i]];void 0===s&&(s=r,i=e),t=w(s)?s.call(t):s}return t}function f(){var t=u.apply(this,arguments);return t.sources.forEach(function(n){a(t.target,n,t.deep,!0)}),t.target}function p(t){for(var n=_.keys(t),r=n.length,e=Array(r),i=0;i<r;i++)e[i]=t[n[i]];return e}function d(t,n){var r;if(void 0===t||null===t)r=t;else if(n&&t.clone)r=t.clone();else if(T(t)){r=[];for(var e=0;e<t.length;e++)r.push(d(t[e]))}else if(b(t)){r={};for(var i in t)r[i]=d(t[i])}else r=t;return r}var y,m,v=Object.prototype.hasOwnProperty,x=Array.prototype.slice,g=t.isBoolean,w=t.isFunction,k=t.isObject,b=t.isPlainObject,T=t.isArray,j="undefined"!=typeof Symbol?Symbol.prototype:null;return y=function(t,n,r,e){if(t===n)return 0!==t||1/t===1/n;if(null==t||null==n)return!1;if(t!==t)return n!==n;var i=typeof t;return("function"===i||"object"===i||"object"==typeof n)&&m(t,n,r,e)},m=function(t,n,r,e){var i=toString.call(t);if(i!==toString.call(n))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!==+t?+n!==+n:0===+t?1/+t===1/n:+t===+n;case"[object Date]":case"[object Boolean]":return+t===+n;case"[object Symbol]":return j.valueOf.call(t)===j.valueOf.call(n)}var s="[object Array]"===i;if(!s){if("object"!=typeof t||"object"!=typeof n)return!1;var o=t.constructor,a=n.constructor;if(o!==a&&!(w(o)&&o instanceof o&&w(a)&&a instanceof a)&&"constructor"in t&&"constructor"in n)return!1}r=r||[],e=e||[];for(var u=r.length;u--;)if(r[u]===t)return e[u]===n;if(r.push(t),e.push(n),s){if(u=t.length,u!==n.length)return!1;for(;u--;)if(!y(t[u],n[u],r,e))return!1}else{var h,c=Object.keys(t);if(u=c.length,Object.keys(n).length!==u)return!1;for(;u--;)if(h=c[u],void 0===n[h]||!y(t[h],n[h],r,e))return!1}return r.pop(),e.pop(),!0},{allKeys:r,clone:d,defaults:n(r,!0),has:i,isEqual:s,isMatch:o,keys:e,mixin:h,removeItem:c,result:l,safeMixin:f,values:p}}),define("skylark-langx/klass",["./arrays","./objects","./types"],function(t,n,r){var e=t.uniq,i=n.has,s=n.mixin,o=r.isArray,a=r.isDefined,u=function(){function t(t,n,r){var e=t.prototype,i=t.superclass.prototype,s=r&&r.noOverrided;for(var o in n)if("constructor"!==o){var a=n[o];"function"==typeof n[o]?e[o]=a._constructor||s||"function"!=typeof i[o]?a:function(t,n,r){return function(){var t=this.overrided;this.overrided=r;var e=n.apply(this,arguments);return this.overrided=t,e}}(o,a,i[o]):"object"==typeof a&&null!==a&&a.get?Object.defineProperty(e,o,a):e[o]=a}return t}function n(t,n){var r=[];return n.forEach(function(t){if(i(t,"__mixins__"))throw new Error("nested mixins");for(var n=[];t;)n.unshift(t),t=t.superclass;r=r.concat(n)}),r=e(r),r=r.filter(function(n){for(var r=t;r;){if(n===r)return!1;if(i(r,"__mixins__"))for(var e=r.__mixins__,s=0;s<e.length;s++)if(e[s]===n)return!1;r=r.superclass}return!0}),r.length>0&&r}function r(t,n){for(var r=t,e=0;e<n.length;e++){var i=new Function;i.prototype=Object.create(r.prototype),i.__proto__=r,i.superclass=null,s(i.prototype,n[e].prototype),i.prototype.__mixin__=n[e],r=i}return r}return function u(e,i,s,h){o(i)&&(h=s,s=i,i=null),i=i||Object,a(s)&&!o(s)&&(h=s,s=!1);var c=i;s&&(s=n(c,s)),s&&(c=r(c,s));var l=e.constructor;l===Object&&(l=function(){if(this.init)return this.init.apply(this,arguments)});var f=e.klassName||"",p=new Function("return function "+f+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return p._constructor=l,p.prototype=Object.create(c.prototype),p.prototype.constructor=p,p.superclass=i,p.__proto__=c,s&&(p.__mixins__=s),p.partial||(p.partial=function(n,r){return t(this,n,r)}),p.inherit||(p.inherit=function(t,n,r){return u(t,this,n,r)}),p.partial(e,h),p}},h=u();return h}),define("skylark-langx/ArrayStore",["./klass"],function(t){var n=function(t,n){function r(t,n,r){var e,i=0,s=t&&t.length||0,o=[];if(s&&"string"==typeof t&&(t=t.split("")),"string"==typeof n&&(n=cache[n]||buildFn(n)),r)for(;i<s;++i)e=t[i],n.call(r,e,i,t)&&o.push(e);else for(;i<s;++i)e=t[i],n(e,i,t)&&o.push(e);return o}function e(e){var i=r(e,t),s=n&&n.sort;if(s&&i.sort("function"==typeof s?s:function(t,n){for(var r,e=0;r=s[e];e++){var i=t[r.attribute],o=n[r.attribute];if(i=null!=i?i.valueOf():i,o=null!=o?o.valueOf():o,i!=o)return!!r.descending==(null==i||i>o)?-1:1}return 0}),n&&(n.start||n.count)){var o=i.length;i=i.slice(n.start||0,(n.start||0)+(n.count||1/0)),i.total=o}return i}switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var i=t;t=function(t){for(var n in i){var r=i[n];if(r&&r.test){if(!r.test(t[n],t))return!1}else if(r!=t[n])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}return e.matches=t,e},r=function(t){function n(n){t[n]=function(){var i=arguments,s=Deferred.when(t,function(t){return r(Array.prototype[n].apply(t,i))});if("forEach"!==n||e)return s}}if(!t)return t;var e=!!t.then;return e&&(t=Object.delegate(t)),n("forEach"),n("filter"),n("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},e=t({klassName:"ArrayStore",queryEngine:n,idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,n){var r=this.data,e=this.index,i=this.idProperty,s=t[i]=n&&"id"in n?n.id:i in t?t[i]:Math.random();if(s in e){if(n&&n.overwrite===!1)throw new Error("Object already exists");r[e[s]]=t}else e[s]=r.push(t)-1;return s},add:function(t,n){return(n=n||{}).overwrite=!1,this.put(t,n)},remove:function(t){var n=this.index,r=this.data;if(t in n)return r.splice(n[t],1),this.setData(r),!0},query:function(t,n){return r(this.queryEngine(t,n)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var n=0,r=t.length;n<r;n++)this.index[t[n][this.idProperty]]=n},init:function(t){for(var n in t)this[n]=t[n];this.setData(this.data||[])}});return e}),define("skylark-langx/aspect",[],function(){function t(t,n,r,i){var s,o=t[n],a="around"==n;if(a){var u=r(function(){return o.advice(this,arguments)});s={remove:function(){u&&(u=t=r=null)},advice:function(t,n){return u?u.apply(t,n):o.advice(t,n)}}}else s={remove:function(){if(s.advice){var e=s.previous,i=s.next;i||e?(e?e.next=i:t[n]=i,i&&(i.previous=e)):delete t[n],t=r=s.advice=null}},id:e++,advice:r,receiveArguments:i};if(o&&!a)if("after"==n){for(;o.next&&(o=o.next););o.next=s,s.previous=o}else"before"==n&&(t[n]=s,s.next=o,o.previous=s);else t[n]=s;return s}function n(n){return function(i,s,o,a){var u,h=i[s];h&&h.target==i||(i[s]=u=function(){for(var t=e,n=arguments,i=u.before;i;)n=i.advice.apply(this,n)||n,i=i.next;if(u.around)var s=u.around.advice(this,n);for(var o=u.after;o&&o.id<t;){if(o.receiveArguments){var a=o.advice.apply(this,n);s=a===r?s:a}else s=o.advice.call(this,s,n);o=o.next}return s},h&&(u.around={advice:function(t,n){return h.apply(t,n)}}),u.target=i);var c=t(u||h,n,o,a);return o=null,c}}var r,e=0;return{after:n("after"),around:n("around"),before:n("before")}}),define("skylark-langx/funcs",["./objects","./types"],function(t,n){function r(t){return requestAnimationFrame?requestAnimationFrame(t):setTimeoutout(t),this}function e(){}function i(t,n){var r=2 in arguments&&slice.call(arguments,2);if(a(t)){var e=function(){return t.apply(n,r?r.concat(slice.call(arguments)):arguments)};return e}if(u(n))return r?(r.unshift(t[n],t),i.apply(null,r)):i(t[n],t);throw new TypeError("expected function")}function s(t,n){var r;return function(){var e=this,i=arguments,s=function(){r=null,t.apply(e,i)};r&&clearTimeout(r),r=setTimeout(s,n)}}var o=t.mixin,a=n.isFunction,u=n.isString,h=function(){function t(){}return function(n,r){t.prototype=n;var e=new t;return t.prototype=null,r&&o(e,r),e}}();return{debounce:s,delegate:h,defer:r,noop:e,proxy:i,returnTrue:function(){return!0},returnFalse:function(){return!1}}}),define("skylark-langx/Deferred",["./arrays","./funcs","./objects"],function(t,n,r){"use strict";function e(t,n){var r={state:function(){return n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},then:function(t,n,e){return e&&this.progress(e),h(Promise.prototype.then.call(this,t&&function(n){return n&&void 0!==n.__ctx__?t.apply(n.__ctx__,n):t(n)},n&&function(t){return t&&void 0!==t.__ctx__?n.apply(t.__ctx__,t):n(t)}),r)},progress:function(t){return n[i].push(t),this}};return r.pipe=r.then,h(t,r)}var i=Symbol?Symbol():"__pglisteners",s=Array.prototype.slice,o=n.proxy,a=t.makeArray,u=r.result,h=r.mixin;h(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(t){return this.then(t),this},fail:function(t){return this["catch"](t),this}});var c=function(){var t=this,n=this.promise=new Promise(function(n,r){t._resolve=n,t._reject=r});e(n,t),this[i]=[]};return c.prototype.resolve=function(t){var n=s.call(arguments);return this.resolveWith(null,n)},c.prototype.resolveWith=function(t,n){return n=n?a(n):[],n.__ctx__=t,this._resolve(n),this._resolved=!0,this},c.prototype.progress=function(t){try{return this[i].forEach(function(n){return n(t)})}catch(n){this.reject(n)}return this},c.prototype.reject=function(t){var n=s.call(arguments);return this.rejectWith(null,n)},c.prototype.rejectWith=function(t,n){return n=n?a(n):[],n.__ctx__=t,this._reject(n),this._rejected=!0,this},c.prototype.isResolved=function(){return!!this._resolved},c.prototype.isRejected=function(){return!!this._rejected},c.prototype.then=function(t,n,r){var e=u(this,"promise");return e.then(t,n,r)},c.prototype.done=c.prototype.then,c.all=function(t){return e(Promise.all(t))},c.first=function(t){return e(Promise.race(t))},c.when=function(t,n,r,e){var i=t&&"function"==typeof t.then,s=i&&t instanceof Promise;if(!i)return arguments.length>1?n?n(t):t:(new c).resolve(t);if(!s){var a=new c(t.cancel);t.then(o(a.resolve,a),o(a.reject,a),a.progress),t=a.promise}return n||r||e?t.then(n,r,e):t},c.reject=function(t){var n=new c;return n.reject(t),n.promise},c.resolve=function(t){var n=new c;return n.resolve.apply(n,arguments),n.promise},c.immediate=c.resolve,c}),define("skylark-langx/async",["./Deferred","./arrays"],function(t,n){var r=n.each,e={parallel:function(n,e,i){var s=[];return i=i||null,e=e||[],r(n,function(t,n){s.push(n.apply(i,e))}),t.all(s)},series:function(n,e,i){var s=[],o=new t,a=o.promise;return i=i||null,e=e||[],o.resolve(),r(n,function(t,n){a=a.then(function(){return n.apply(i,e)}),s.push(a)}),t.all(s)},waterful:function(n,e,i){var s=new t,o=s.promise;return i=i||null,e=e||[],s.resolveWith(i,e),r(n,function(t,n){o=o.then(n)}),o}};return e}),define("skylark-langx/Evented",["./klass","./objects","./types"],function(t,n,r){var e=Array.prototype.slice,i=r.isDefined,s=r.isPlainObject,o=r.isFunction,a=r.isString,u=r.isEmptyObject,h=n.mixin,c=t({on:function(t,n,r,e,i,u){var h=this,c=this._hub||(this._hub={});return s(t)?(i=e,each(t,function(t,e){h.on(t,n,r,e,i,u)}),this):(a(n)||o(e)||(i=e,e=r,r=n,n=void 0),o(r)&&(i=e,e=r,r=null),a(t)&&(t=t.split(/\s/)),t.forEach(function(t){(c[t]||(c[t]=[])).push({fn:e,selector:n,data:r,ctx:i,one:u})}),this)},one:function(t,n,r,e,i){return this.on(t,n,r,e,i,1)},trigger:function(t){if(!this._hub)return this;var n=this;a(t)&&(t=new CustomEvent(t)),Object.defineProperty(t,"target",{value:this});var r=e.call(arguments,1);return r=i(r)?[t].concat(r):[t],[t.type||t.name,"all"].forEach(function(e){var i=n._hub[e];if(i){for(var s=i.length,o=!1,a=0;a<s;a++){var u=i[a];t.data?u.data&&(t.data=h({},u.data,t.data)):t.data=u.data||null,u.fn.apply(u.ctx,r),u.one&&(i[a]=null,o=!0)}o&&(n._hub[e]=compact(i))}}),this},listened:function(t){var n=(this._hub||(this._events={}))[t]||[];return n.length>0},listenTo:function(t,n,r,e){if(!t)return this;a(r)&&(r=this[r]),e?t.one(n,r,this):t.on(n,r,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),o=0;o<s.length;o++)if(s[o].obj==t){i=s[o];break}i||s.push(i={obj:t,events:{}});var u=i.events,h=u[n]=u[n]||[];return h.indexOf(r)==-1&&h.push(r),this},listenToOnce:function(t,n,r){return this.listenTo(t,n,r,1)},off:function(t,n){var r=this._hub||(this._hub={});return a(t)&&(t=t.split(/\s/)),t.forEach(function(t){var e=r[t],i=[];if(e&&n)for(var s=0,o=e.length;s<o;s++)e[s].fn!==n&&e[s].fn._!==n&&i.push(e[s]);i.length?r[t]=i:delete r[t]}),this},unlistenTo:function(t,n,r){var e=this._listeningTo;if(!e)return this;for(var i=0;i<e.length;i++){var s=e[i];if(!t||t==s.obj){var o=s.events;for(var a in o)if(!n||n==a){for(var h=o[a],c=0;c<h.length;c++)r&&r!=h[i]||(s.obj.off(a,h[i],this),h[i]=null);h=o[a]=compact(h),u(h)&&(o[a]=null)}u(o)&&(e[i]=null)}}return e=this._listeningTo=compact(e),u(e)&&(this._listeningTo=null),this}});return c}),define("skylark-langx/strings",[],function(){function t(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()}function n(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(n){return t}}function r(t){return null==t?"":String.prototype.trim.call(t)}function e(t,n,r,e){function i(t,n){if(t.match(/\./)){var r,e=function(t,n){var i=t.pop();return i?n[i]?e(t,r=n[i]):null:r};return e(t.split(".").reverse(),n)}return n[t]}return e=e||window,r=r?proxy(e,r):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,s,o){var a=i(s,n);return o&&(a=i(o,e).call(e,a,s)),r(a,s).toString()})}return{camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},dasherize:t,deserializeValue:n,lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},serializeValue:function(t){return JSON.stringify(t)},substitute:e,trim:r,upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}),define("skylark-langx/Xhr",["./arrays","./Deferred","./Evented","./objects","./funcs","./types"],function(arrays,Deferred,Evented,objects,funcs,types){var each=arrays.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(){var t;return function(n){return t||(t=document.createElement("a")),t.href=n,t.href}}(),Xhr=function(){function mimeToDataType(t){if(t&&(t=t.split(";",2)[0]),t){if(t==htmlType)return"html";if(t==jsonType)return"json";if(scriptTypeRE.test(t))return"script";if(xmlTypeRE.test(t))return"xml"}return"text"}function appendQuery(t,n){return""==n?t:(t+"&"+n).replace(/[&?]{1,2}/,"?")}function serializeData(t){t.data=t.data||t.query,t.processData&&t.data&&"string"!=type(t.data)&&(t.data=param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=appendQuery(t.url,t.data),t.data=void 0)}function serialize(t,n,r,e){var i,s=isArray(n),o=isPlainObject(n);each(n,function(n,a){i=type(a),e&&(n=r?e:e+"["+(o||"object"==i||"array"==i?n:"")+"]"),!e&&s?t.add(a.name,a.value):"array"==i||!r&&"object"==i?serialize(t,a,r,n):t.add(n,a)})}var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}},param=function(t,n){var r=[];return r.add=function(t,n){isFunction(n)&&(n=n()),null==n&&(n=""),this.push(escape(t)+"="+escape(n))},serialize(r,t,n),r.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(e){error=e}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(t){deferred&&deferred.progress(t,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&contentType!==!1&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var t=this._,n=t.xhr;n&&n.abort()},request:function(t){return this._request(t)},get:function(t){return t=t||{},t.type="GET",this._request(t)},post:function(t){return t=t||{},t.type="POST",this._request(t)},patch:function(t){return t=t||{},t.type="PATCH",this._request(t)},put:function(t){return t=t||{},t.type="PUT",this._request(t)},del:function(t){return t=t||{},t.type="DELETE",this._request(t)},init:function(t){this._={options:t||{}}}});return["request","get","post","put","del","patch"].forEach(function(t){Xhr[t]=function(n,r){var e=new Xhr({url:n});return e[t](r)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return Xhr}),define("skylark-langx/Restful",["./Evented","./objects","./strings","./Xhr"],function(t,n,r,e){var i=n.mixin,s=r.substitute,o=t.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(t){var n=s(this.baseEndpoint,t),r=this.server+this.basePath+n;return void 0!==t[this.idAttribute]&&(r=r+"/"+t[this.idAttribute]),r},_head:function(t){},_get:function(t){return e.get(this.getBaseUrl(t),t)},_post:function(t,n){var r=this.getBaseUrl(t);return n&&(r=r+"/"+n),e.post(r,t)},_put:function(t,n){var r=this.getBaseUrl(t);return n&&(r=r+"/"+n),e.put(r,t)},_delete:function(t){var n=this.getBaseUrl(t);return e.del(n)},_patch:function(t){var n=this.getBaseUrl(t);return e.patch(n,t)},query:function(t){return this._post(t)},retrieve:function(t){return this._get(t)},create:function(t){return this._post(t)},update:function(t){return this._put(t)},"delete":function(t){return this._delete(t)},patch:function(t){return this._patch(t)},init:function(t){i(this,t)}});return o}),define("skylark-langx/Stateful",["./Evented"],function(t){var n=t.inherit({init:function(t,n){var r=t||{};n||(n={}),this.cid=uniqueId(this.cidPrefix),this.attributes={},n.collection&&(this.collection=n.collection),n.parse&&(r=this.parse(r,n)||{});var e=result(this,"defaults");r=mixin({},e,r),this.set(r,n),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return clone(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,n,r){if(null==t)return this;var e;if("object"==typeof t?(e=t,r=n):(e={})[t]=n,r||(r={}),!this._validate(e,r))return!1;var i=r.unset,s=r.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=clone(this.attributes),this.changed={});var u=this.attributes,h=this.changed,c=this._previousAttributes;for(var l in e)n=e[l],isEqual(u[l],n)||o.push(l),isEqual(c[l],n)?delete h[l]:h[l]=n,i?delete u[l]:u[l]=n;if(this.idAttribute in e&&(this.id=this.get(this.idAttribute)),!s){o.length&&(this._pending=r);for(var f=0;f<o.length;f++)this.trigger("change:"+o[f],this,u[o[f]],r)}if(a)return this;if(!s)for(;this._pending;)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(t,n){return this.set(t,void 0,mixin({},n,{unset:!0}))},clear:function(t){var n={};for(var r in this.attributes)n[r]=void 0;return this.set(n,mixin({},t,{unset:!0}))},hasChanged:function(t){return null==t?!isEmptyObject(this.changed):void 0!==this.changed[t]},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&clone(this.changed);var n=this._changing?this._previousAttributes:this.attributes,r={};for(var e in t){var i=t[e];isEqual(n[e],i)||(r[e]=i)}return!isEmptyObject(r)&&r},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return clone(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},mixin({},t,{validate:!0}))},_validate:function(t,n){if(!n.validate||!this.validate)return!0;t=mixin({},this.attributes,t);var r=this.validationError=this.validate(t,n)||null;return!r||(this.trigger("invalid",this,r,mixin(n,{validationError:r})),!1)}});return n}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./Deferred","./Evented","./funcs","./klass","./objects","./Restful","./Stateful","./strings","./types","./Xhr"],function(t,n,r,e,i,s,o,a,u,h,c,l,f,p,d){"use strict";function y(t,n){var r=new CustomEvent(t,n);return b(r,n)}function m(t,n,r,e){return T(n)?n.call(t,r,e):n}function v(t){var t=t||window.location.href,n=t.split("?"),r={};return n.length>1&&n[1].split("&").forEach(function(t){var n=t.split("=");r[n[0]]=n[1]}),r}function x(t){return parseFloat(t)||0}function g(t){return t._uid||(t._uid=j++)}function _(t){var n=++A+"";return t?t+n:n}function w(){return w}var k=({}.toString,Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter,h.mixin),b=h.safeMixin,T=p.isFunction,j=1,A=0;return k(w,{createEvent:y,funcArg:m,getQueryParams:v,toPixel:x,uid:g,uniqueId:_,URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),k(w,n,e,a,h,f,p,{ArrayStore:r,async:i,Deferred:s,Evented:o,klass:u,Restful:c,Stateful:l,Xhr:d}),t.langx=w}),define("skylark-utils/langx",["skylark-langx/langx"],function(t){return t}),define("skylark-utils-math/math",["skylark-utils/skylark","skylark-utils/langx"],function(t,n){var r=t.math={log2:function(t){for(var n=1,r=0;t>n;)n<<=1,r++;return r}};return n.mixin(r,Math),r}),define("skylark-utils-math/Geometry",["skylark-langx/langx","./math"],function(t,n){var r=n.Geometry=t.klass({klassName:"Geometry"});return r}),define("skylark-utils-math/Point",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.Point=r.inherit({klassName:"Point",x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},clone:function(){var t=this._;return new e(t.x,t.y)},move:function(t,n){var r=this._;return new e(r.x+t,r.y+n)},notEqual:function(t){var n=this._;return!t||t.x!=n.x||t.y!=n.y},equal:function(t){return!this.notEqual(t)},init:function(t,n){var r=this._={};r.x=t||0,r.y=n||0}});return e.fromString=function(t){var n=t.split(",");return new e(parseFloat(n[0]),parseFloat(n[1]))},e.fromPlain=function(t){return new e(t.x,t.y)},e.fromArray=function(t){return new e(t[0],t[1])},e.Zero=new e(0,0),e}),define("skylark-utils-math/Arrow",["skylark-langx/langx","./math","./Geometry","./Point"],function(t,n,r,e){var i={left:1,top:2,right:3,bottom:4},s=n.Arrow=r.inherit({klassName:"Arrow",bounds:{get:function(){var t=this._,n={x:t.x,y:this.y,width:t.width,height:t.height};return n}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},direction:{get:function(){return this._.direction}},leftTop:{get:function(){var t=this._;return new e(t.x,t.y)}},leftBottom:{get:function(){var t=this._;return new e(t.x,t.y+t.height)}},rightTop:{get:function(){var t=this._;return new e(t.x+t.width,t.y)}},rightBottom:{get:function(){var t=this._;return new e(t.x+t.width,t.y+t.height)}},move:function(t,n){var r=this._;return new s(r.x+t,r.y+n,r.width,r.height,r.direction)},containPoint:function(t,n){if(void 0===n){var r=t;t=r.x,n=r.y}var e=this._;return t>=e.x&&t<e.x+e.width&&n>=e.y&&n<e.y+e.height},init:function(t,n,r,e,s){var o=this._={};o.x=t||0,o.y=n||0,o.width=r||0,o.height=e||0,o.direction=s||i.top}});return s.Direction=i,s}),define("skylark-utils-math/Circle",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.Circle=r.inherit({klassName:"Circle",bounds:{get:function(){var t=this._,n={x:t.cx-t.r,y:t.cy-t.r,width:2*t.r,height:2*t.r};return n}},cx:{get:function(){return this._.cx}},cy:{get:function(){return this._.cy}},r:{get:function(){return this._.r}},move:function(t,n){var r=this._;return new e(r.cx+t,r.cy+n,r.r)},containPoint:function(t,n){if(void 0===n){var r=t;t=r.x,n=r.y}var e=this._,i=(t-e.x)*(t-e.x)+(n-e.y)*(n-e.y);return i<e.r*e.r},init:function(t,n,r){var e=this._={};e.cx=t||0,e.cy=n||0,e.r=r||0}});return e}),define("skylark-utils-math/Ellipse",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.Ellipse=r.inherit({klassName:"Ellipse",bounds:{get:function(){var t=this._,n={x:t.cx-t.rx,y:t.cy-t.ry,width:2*t.rx,height:2*t.ry};return n}},cx:{get:function(){return this._.cx}},cy:{get:function(){return this._.cy}},rx:{get:function(){return this._.rx}},ry:{get:function(){return this._.ry}},move:function(t,n){var r=this._;return new e(r.cx+t,r.cy+n,r.rx,r.ry)},containPoint:function(t){},init:function(t,n,r,e){var i=this._={};i.cx=t||0,i.cy=n||0,i.rx=r||0,i.ry=e||0}});return e}),define("skylark-utils-math/Line",["skylark-langx/langx","./math","./Geometry","./Point"],function(t,n,r,e){var i=n.Line=r.inherit({klassName:"Line",bounds:{get:function(){var t=this._,n={x:Math.min(t.x1,t.x2),y:Math.min(t.y1,t.y2),width:Math.abs(t.x2-t.x1),height:Math.abs(t.y2-t.y1)};return n}},x1:{get:function(){return this._.x1}},y1:{get:function(){return this._.y1}},x2:{get:function(){return this._.x2}},y2:{get:function(){return this._.y2;
}},startPoint:{get:function(){var t=this._;return new e(t.x1,t.y1)}},endPointer:{get:function(){var t=this._;return new e(t.x2,t.y2)}},move:function(t,n){var r=this._;return new i(r.x1+t,r.y1+n,r.x2+t,r.y2+n)},containPoint:function(t,n){if(void 0===n){var r=t;t=r.x,n=r.y}var e=this._;return Math.abs((n-e.y1)*(e.x2-e.x1)-(e.y2-e.y1)*(t-e.x1))<1e-6},init:function(t,n,r,e){var i=this._={};i.x1=t||0,i.y1=n||0,i.x2=r||0,i.y2=e||0}});return i}),define("skylark-utils-math/Polyline",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.Polyline=r.inherit({klassName:"Polyline",bounds:{get:function(){for(var t=this._,n=t.points,r=n.length,e=n[0],i={l:e.x,t:e.y,r:e.x,b:e.y},s=1;s<r;++s)e=n[s],i.l>e.x&&(i.l=e.x),i.r<e.x&&(i.r=e.x),i.t>e.y&&(i.t=e.y),i.b<e.y&&(i.b=e.y);var o={x:i.l,y:i.t,width:i.r-i.l,height:i.b-i.t};return o}},points:{get:function(){return this._.points}},init:function(t){var n=this._={};n.points=t?t:[]}});return e}),define("skylark-utils-math/PolyStar",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.PolyStar=r.inherit({klassName:"PolyStar",bounds:{get:function(){var t=this._,n=t.points,r=n.length,e=n[0];bbox={l:e.x,t:e.y,r:e.x,b:e.y};for(var i=1;i<r;++i)e=n[i],bbox.l>e.x&&(bbox.l=e.x),bbox.r<e.x&&(bbox.r=e.x),bbox.t>e.y&&(bbox.t=e.y),bbox.b<e.y&&(bbox.b=e.y);var s={x:bbox.l,y:bbox.t,width:bbox.r-bbox.l,height:bbox.b-bbox.t};return s}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},radius:{get:function(){return this._.radius}},sides:{get:function(){return this._.sides}},pointSize:{get:function(){return this._.pointSize}},angle:{get:function(){return this._.angle}},init:function(t,n,r,e,i,s){var o=this._;o.x=t,o.y=n,o.radius=r,o.sides=e,o.pointSize=i,o.angle=s}});return e}),define("skylark-utils-math/Size",["skylark-langx/langx","./math","./Geometry"],function(t,n,r){var e=n.Size=r.inherit({klassName:"Size",width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},clone:function(){var t=this._;return new e(t.width,t.height)},toArray:function(){return[this.width,this.height]},toPlain:function(){return{width:this.width,height:this.height}},toString:function(){return this.width+","+this.height},init:function(t,n){var r=this._={};r.width=t||0,r.height=n||0}});return e.fromString=function(t){var n=t.split(",");return new e(parseFloat(n[0]),parseFloat(n[1]))},e.fromPlain=function(t){return new e(t.w||t.width,t.h||t.height)},e.fromArray=function(t){return new e(t[0],t[1])},e.Zero=new e(0,0),e}),define("skylark-utils-math/Rect",["skylark-langx/langx","./math","./Geometry","./Point","./Size"],function(t,n,r,e,i){var s=n.Rect=r.inherit({klassName:"Rect",bounds:{get:function(){var t=this._,n={x:t.x,y:this.y,width:t.width,height:t.height};return n}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},radius:{get:function(){return this._.radius}},leftTop:{get:function(){var t=this._;return new e(t.x,t.y)}},leftBottom:{get:function(){var t=this._;return new e(t.x,t.y+t.height)}},rightTop:{get:function(){var t=this._;return new e(t.x+t.width,t.y)}},rightBottom:{get:function(){var t=this._;return new e(t.x+t.width,t.y+t.height)}},size:{get:function(){var t=this._;return new i(t.width,t.height)}},move:function(t,n){var r=this._;return new s(r.x+t,r.y+n,r.width,r.height,r.radius)},containPoint:function(t,n){if(void 0===n){var r=t;t=r.x,n=r.y}var e=this._;return t>=e.x&&t<e.x+e.width&&n>=e.y&&n<e.y+e.height},isEmpty:function(){return this.width<=0||this.height<=0},notEqual:function(t){return!t||t.x!=this.x||t.y!=this.y||t.width!=this.width||t.height!=this.height||t.radius!=this.radius},equal:function(t){return!this.notEqual(t)},isIntersect:function(t,n,r,e){var i=this.x1,s=this.y,o=this.width,a=this.height;return Math.min(i+o,t+r)-(i>t?i:t)>0&&Math.min(s+a,n+e)-(s>n?s:n)>0},intersect:function(t,n,r,e){var i=this.x1,s=this.y,o=this.width,a=this.height;return Math.min(i+o,t+r)-(i>t?i:t)>0&&Math.min(s+a,n+e)-(s>n?s:n)>0},unite:function(t,n,r,e){var i=this.x1,o=this.y,a=this.width,u=this.height,h=i<t?i:t,c=o<n?o:n,l=Math.max(i+a,t+r)-h;return height=Math.max(o+u,n+e)-c,new s(h,c,l,height)},clone:function(){var t=this._;return new s(t.x,t.y,t.width,t.height,t.radius)},init:function(t,n,r,e,i){var s=this._={};s.x=t||0,s.y=n||0,s.width=r||0,s.height=e||0,s.radius=i||0}});return s.fromString=function(t){var n=t.split(",");return new s(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))},s.fromPlain=function(t){return new s(t.x||t.l,t.y||t.t,t.w||t.width,t.h||t.height)},s.fromArray=function(t){return new s(t[0],t[1],t[2],t[3])},s.Zero=new s(0,0,0,0),s}),define("skylark-utils-math/transform/Matrix",["skylark-langx/langx","../math"],function(t,n){var r=Math.PI/180,e={},i=function(t){return e[t]||(e[t]=Math.PI*t/180)},s=n.TransformMatrix=t.klass({klassName:"TransformMatrix",_multiplyPoint:function(t){var n=this._,r=t.x*n.m11+t.y*n.m21+n.dx,e=t.x*n.m12+t.y*n.m22+n.dy;return new Point(r,e)},m11:{get:function(){return this._.m11}},m12:{get:function(){return this._.m12}},m21:{get:function(){return this._.m21}},m22:{get:function(){return this._.m22}},dx:{get:function(){return this._.dx}},dy:{get:function(){return this._.dy}},alpha:{get:function(){return this._.alpha}},shadow:{get:function(){return this._.shadow}},compositeOperation:{get:function(){return this._.compositeOperation}},multiplyPoint:function(t){return this._multiplyPoint(t)},multiplyRectangle:function(t){if(this.isIdentity())return t.clone();var n=this.multiplyPoint(t.leftTop),r=this.multiplyPoint(t.leftBottom),e=this.multiplyPoint(t.right),i=this.multiplyPoint(t.rightBottom),s=Math.min(n.x,r.x,e.x,i.x),o=Math.min(n.y,r.y,e.y,i.y),a=Math.max(n.x,r.x,e.x,i.x),u=Math.max(n.y,r.y,e.y,i.y);return new Rect(s,o,a-s,u-o)},prepend:function(t,n,r,e,i,s){var o=this.dx;if(1!=t||0!=n||0!=r||1!=e){var a=this.m11,u=this.m21;this.m11=a*t+this.m12*r,this.m12=a*n+this.m12*e,this.m21=u*t+this.m22*r,this.m22=u*n+this.m22*e}return this.dx=o*t+this.dy*r+i,this.dy=o*n+this.dy*e+s,this},append:function(t,n,r,e,i,s){var o=this.m11,a=this.m12,u=this.m21,h=this.m22;return this.m11=t*o+n*u,this.m12=t*a+n*h,this.m21=r*o+e*u,this.m22=r*a+e*h,this.dx=i*o+s*u+this.dx,this.dy=i*a+s*h+this.dy,this},prependMatrix:function(t){return this.prepend(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.prependProperties(t.alpha,t.shadow,t.compositeOperation),this},appendMatrix:function(t){return this.append(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.appendProperties(t.alpha,t.shadow,t.compositeOperation),this},prependTransform:function(t,n,e,i,s,o,a,u,h){if(s%360)var c=s*r,l=Math.cos(c),f=Math.sin(c);else l=1,f=0;return(u||h)&&(this.dx-=u,this.dy-=h),o||a?(o*=r,a*=r,this.prepend(l*e,f*e,-f*i,l*i,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,n)):this.prepend(l*e,f*e,-f*i,l*i,t,n),this},appendTransform:function(t,n,e,i,s,o,a,u,h){if(s%360)var c=s*r,l=Math.cos(c),f=Math.sin(c);else l=1,f=0;return o||a?(o*=r,a*=r,this.append(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,n),this.append(l*e,f*e,-f*i,l*i,0,0)):this.append(l*e,f*e,-f*i,l*i,t,n),(u||h)&&(this.dx-=u*this.m11+h*this.m21,this.dy-=u*this.m12+h*this.m22),this},rotate:function(t){var n=Math.cos(t),r=Math.sin(t),e=this.m11,i=this.m21,s=this.dx;return this.m11=e*n-this.m12*r,this.m12=e*r+this.m12*n,this.m21=i*n-this.m22*r,this.m22=i*r+this.m22*n,this.dx=s*n-this.dy*r,this.dy=s*r+this.dy*n,this},skew:function(t,n){return t*=r,n*=r,this.append(Math.cos(n),Math.sin(n),-Math.sin(t),Math.cos(t),0,0),this},scale:function(t,n){return this.m11*=t,this.m22*=n,this.dx*=t,this.dy*=n,this},translate:function(t,n){return this.dx+=t,this.dy+=n,this},identity:function(){return this.alpha=this.m11=this.m22=1,this.m12=this.m21=this.dx=this.dy=0,this.shadow=this.compositeOperation=null,this},invert:function(){var t=this.m11,n=this.m12,r=this.m21,e=this.m22,i=this.dx,s=t*e-n*r;return this.m11=e/s,this.m12=-n/s,this.m21=-r/s,this.m22=t/s,this.dx=(r*this.dy-e*i)/s,this.dy=-(t*this.dy-n*i)/s,this},isIdentity:function(){return 0==this.dx&&0==this.dy&&1==this.m11&&0==this.m12&&0==this.m21&&1==this.m22},decompose:function(t){null==t&&(t={}),t.x=this.dx,t.y=this.dy,t.scaleX=Math.sqrt(this.m11*this.m11+this.m12*this.m12),t.scaleY=Math.sqrt(this.m21*this.m21+this.m22*this.m22);var n=Math.atan2(-this.m21,this.m22),e=Math.atan2(this.m12,this.m11);return n==e?(t.rotation=e/r,this.m11<0&&this.m22>=0&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=n/r,t.skewY=e/r),t},reinitialize:function(t,n,r,e,i,s,o,a,u){return this._initialize(t,n,r,e,i,s),this.alpha=o||1,this.shadow=a,this.compositeOperation=u,this},appendProperties:function(t,n,r){return this.alpha*=t,this.shadow=n||this.shadow,this.compositeOperation=r||this.compositeOperation,this},prependProperties:function(t,n,r){return this.alpha*=t,this.shadow=this.shadow||n,this.compositeOperation=this.compositeOperation||r,this},multiply:function(t){var n=this.m11,r=this.m12,e=this.m21,i=this.m22,s=this.dx,o=this.dy,a=t;return this.m11=n*a.m11+e*a.m12,this.m12=r*a.m11+i*a.m12,this.m21=n*a.m21+e*a.m22,this.m22=r*a.m21+i*a.m22,this.dx=n*a.dx+e*a.dy+s,this.dy=r*a.dx+i*a.dy+o,this},clone:function(){var t=this._,n=new s(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy);return n.shadow=this.shadow,n.alpha=this.alpha,n.compositeOperation=this.compositeOperation,n},toString:function(){var t=this._;return"[Matrix (m11="+t.m11+" m12="+t.m12+" m21="+t.m21+" m22="+t.m22+" dx="+t.dx+" dy="+t.dy+")]"},init:function(t,n,r,e,i,s){var o=this._;o.m11=t||1,o.m12=n||0,o.m21=r||0,o.m22=e||1,o.dx=i||0,o.dy=s||0}});return t.mixin(s,{translate:function(t,n){return new s(1,0,0,1,t,n)},scale:function(t,n){return new s(t,0,0,n?n:t,0,0)},rotate:function(t){var n=Math.cos(t),r=Math.sin(t);return new s(n,r,(-r),n,0,0)},rotateg:function(t){return this.rotate(i(t))},skewX:function(t){var n=Math.tan(t);return new s(1,0,n,1)},skewXg:function(t){return this.skewX(i(t))},skewY:function(t){var n=Math.tan(t);return new s(1,n,0,1)},skewYg:function(t){return this.skewY(i(t))},reflect:function(t,n){1==arguments.length&&(n=t.y,t=t.x);var r=t*t,e=n*n,i=r+e,o=2*r/i-1,a=2*t*n/i,u=a,h=2*e/i-1;return new s(o,u,a,h)},project:function(t,n){var r=t*t,e=n*n,i=r+e,o=r/i,a=t*n/i;return yx=a,yy=e/i,new s(o,yx,a,yy)},_sandwich:function(t,n,r){return this.translate(n,r).multiply(t).multiply(this.translate(-n,-r))},scaleAt:function(t,n,r,e){switch(arguments.length){case 4:return this._sandwich(this.scale(t,n),r,e);case 3:return"number"==typeof r?this._sandwich(this.scale(t),n,r):this._sandwich(this.scale(t,n),r.x,r.y)}return this._sandwich(this.scale(t),n.x,n.y)},rotateAt:function(t,n,r){return arguments.length>2?this._sandwich(this.rotate(t),n,r):this._sandwich(this.rotate(t),n.x,n.y)},rotategAt:function(t,n,r){return arguments.length>2?this._sandwich(this.rotateg(t),n,r):this._sandwich(this.rotateg(t),n.x,n.y)},skewXAt:function(t,n,r){return arguments.length>2?this._sandwich(this.skewX(t),n,r):this._sandwich(this.skewX(t),n.x,n.y)},skewXgAt:function(t,n,r){return arguments.length>2?this._sandwich(this.skewXg(t),n,r):this._sandwich(this.skewXg(t),n.x,n.y)},skewYAt:function(t,n,r){return arguments.length>2?this._sandwich(this.skewY(t),n,r):this._sandwich(this.skewY(t),n.x,n.y)},skewYgAt:function(t,n,r){return arguments.length>2?this._sandwich(this.skewYg(t),n,r):this._sandwich(this.skewYg(t),n.x,n.y)}}),s}),define("skylark-utils-math/transform/Transform",["skylark-langx/langx","../math","./Matrix"],function(t,n,r){var e=n.Transform=t.klass({klassName:"Transform",value:{get:function(){return this._.value}}});return e}),define("skylark-utils-math/transform/MatrixTransform",["skylark-langx/langx","../math","./Transform","../Point","../Rect"],function(t,n,r,e,i){var s=n.MatrixTransform=r.inherit({klassName:"MatrixTransform",value:{get:function(){return this.matrix.clone()}},matrix:{get:function(){return this._.matrix}},clone:function(){},transform:function(t){},transformBounds:function(t){},initialize:function(t){var n=this._;n.matrix=t}});return s}),define("skylark-utils-math/transform/RotateTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,r,e,i,s){var o=n.RotateTransform=r.inherit({klassName:"RotateTransform",value:{get:function(){return e.rotateAt(this.angle,this.centerX,this.centerY)}},angle:{get:function(){return this._.angle}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n,r){var e=this._={};e.angle=t?t:0,e.centerX=n?n:0,e.centerY=r?r:0}});return o}),define("skylark-utils-math/transform/ScaleTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,r,e,i,s){var o=n.ScaleTransform=r.inherit({klassName:"ScaleTransform",value:{get:function(){return e.scaleAt(this.scaleX,this.scaleY,this.centerX,this.centerY)}},scaleX:{get:function(){return this._.scaleX}},scaleY:{get:function(){return this._.scaleY}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n,r,e){var i=this._;i.scaleX=t?t:1,i.scaleY=n?n:1,i.centerX=r?r:0,i.centerY=e?e:0}});return o}),define("skylark-utils-math/transform/SkewTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,r,e,i){var s=math.SkewTransform=n.inherit({klassName:"SkewTransform",value:{get:function(){return r.scaleAt(this.skewX,this.skewY)}},skewX:{get:function(){return this._.skewX}},skewY:{get:function(){return this._.skewY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n){var r=this._;r.skewX=t?t:0,r.skewY=n?n:0}});return s}),define("skylark-utils-math/transform/TranslateTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,r,e,i,s){var o=n.TranslateTransform=r.inherit({klassName:"TranslateTransform",value:{get:function(){return e.scaleAt(this.x,this.y)}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n){var r=this._;r.x=t?t:0,r.y=n?n:0}});return o;var o}),define("skylark-utils-math/main",["./math","./Arrow","./Circle","./Ellipse","./Geometry","./Line","./Point","./Polyline","./PolyStar","./Rect","./Size","./transform/Matrix","./transform/MatrixTransform","./transform/RotateTransform","./transform/ScaleTransform","./transform/SkewTransform","./transform/Transform","./transform/TranslateTransform"],function(t){return t}),define("skylark-utils-math",["skylark-utils-math/main"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-utils-math-all.js.map
