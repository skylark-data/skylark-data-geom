/**
 * skylark-utils-math - The math features enhancement for skylark utils.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.1
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(factory,globals){var define=globals.define,require=globals.require,isAmd="function"==typeof define&&define.amd,isCmd=!isAmd&&"undefined"!=typeof exports;if(!isAmd&&!define){var map={};define=globals.define=function(t,n,e){"function"==typeof e?(map[t]={factory:e,deps:n.map(function(n){return function(t,n){if("."!==t[0])return t;var e=n.split("/"),r=t.split("/");e.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?e.pop():e.push(r[i]));return e.join("/")}(n,t)}),exports:null},require(t)):map[t]=e},require=globals.require=function(t){if(!map.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var n=map[t];if(!n.exports){var e=[];n.deps.forEach(function(t){e.push(require(t))}),n.exports=n.factory.apply(globals,e)}return n.exports}}if(!define)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(define,require){define("skylark-langx/skylark",[],function(){return{}}),define("skylark-langx/types",[],function(){var t,n={}.toString,e=(t={},"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(n){t["[object "+n+"]"]=n.toLowerCase()}),function(e){return null==e?String(e):t[n.call(e)]||"object"});function r(t){var n;for(n in t)if(null!==t[n])return!1;return!0}function i(t){return"function"==e(t)}function s(t){return t&&t instanceof Node}function o(t){return"object"==e(t)}function a(t){return"string"==typeof t}function u(t){return t&&t==t.window}return{isArray:function(t){return t&&t.constructor===Array},isArrayLike:function(t){return!a(t)&&!s(t)&&"number"==typeof t.length&&!i(t)},isBoolean:function(t){return"boolean"==typeof t},isDefined:function(t){return void 0!==t},isDocument:function(t){return null!=t&&t.nodeType==t.DOCUMENT_NODE},isEmpty:r,isEmptyObject:r,isFunction:i,isHtmlNode:s,isNull:function(t){return"null"===e(t)},isNumber:function(t){return"number"==typeof t},isObject:o,isPlainObject:function(t){return o(t)&&!u(t)&&Object.getPrototypeOf(t)==Object.prototype},isString:a,isSameOrigin:function(t){if(t){var n=location.protocol+"//"+location.hostname;return location.port&&(n+=":"+location.port),t.startsWith(n)}},isSymbol:function(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag},isUndefined:function(t){return void 0===t},isWindow:u,type:e}}),define("skylark-langx/arrays",["./types"],function(t,n){var e=Array.prototype.filter,r=t.isArrayLike;function i(t,n,e,r){for(var i=t.length,s=e+(r?1:-1);r?s--:++s<i;)if(n(t[s],s,t))return s;return-1}function s(t){return t!=t}function o(t){if(r(t)){for(var n=[],e=0;e<t.length;e++){var i=t[e];if(r(i))for(var s=0;s<i.length;s++)n.push(i[s]);else n.push(i)}return n}return t}return{baseFindIndex:i,baseIndexOf:function(t,n,e){if(n!=n)return i(t,s,e);var r=e-1,o=t.length;for(;++r<o;)if(t[r]===n)return r;return-1},compact:function(t){return e.call(t,function(t){return null!=t})},first:function(t,n){return n?t.slice(0,n):t[0]},flatten:o,inArray:function(t,n){if(!n)return-1;var e;if(n.indexOf)return n.indexOf(t);e=n.length;for(;e--;)if(n[e]===t)return e;return-1},makeArray:function(t,n,e){if(r(t))return(e||[]).concat(Array.prototype.slice.call(t,n||0));return[t]},forEach:function(t,n){if(t.forEach)return t.forEach(n);for(var e=0;e<t.length;e++)n(t[e],e)},map:function(t,n){var e,i,s,a=[];if(r(t))for(i=0;i<t.length;i++)null!=(e=n.call(t[i],t[i],i))&&a.push(e);else for(s in t)null!=(e=n.call(t[s],t[s],s))&&a.push(e);return o(a)},uniq:function(t){return e.call(t,function(n,e){return t.indexOf(n)==e})}}}),define("skylark-langx/numbers",["./types"],function(t){var n=t.isObject,e=t.isSymbol,r=1/0,i=1.7976931348623157e308,s=NaN,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,h=/^0o[0-7]+$/i,c=parseInt;function f(t){if(!t)return 0===t?t:0;if((t=l(t))===r||t===-r){var n=t<0?-1:1;return n*i}return t==t?t:0}function l(t){if("number"==typeof t)return t;if(e(t))return s;if(n(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=n(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(o,"");var i=u.test(t);return i||h.test(t)?c(t.slice(2),i?2:8):a.test(t)?s:+t}return{toFinite:f,toNumber:l,toInteger:function(t){var n=f(t),e=n%1;return n==n?e?n-e:n:0}}}),define("skylark-langx/objects",["./types","./numbers"],function(t,n){var e,r,i=Object.prototype.hasOwnProperty,s=Array.prototype.slice,o=t.isBoolean,a=t.isFunction,u=t.isObject,h=t.isPlainObject,c=t.isArray,f=t.isArrayLike,l=t.isString,p=n.toInteger;var d,y,m="undefined"!=typeof Symbol?Symbol.prototype:null;function v(t){if(!u(t))return[];var n=[];for(var e in t)n.push(e);return n}function g(t,n){if(!c(n))return null!=t&&i.call(t,n);for(var e=n.length,r=0;r<e;r++){var s=n[r];if(null==t||!i.call(t,s))return!1;t=t[s]}return!!e}function x(t,n,e,r){for(var i in n)r&&void 0!==t[i]||(e&&(h(n[i])||c(n[i]))?(h(n[i])&&!h(t[i])&&(t[i]={}),c(n[i])&&!c(t[i])&&(t[i]=[]),x(t[i],n[i],e,r)):void 0!==n[i]&&(t[i]=n[i]));return t}function w(t){var n=s.call(arguments,0),e=n.shift(),r=!1;return o(n[n.length-1])&&(r=n.pop()),{target:e,sources:n,deep:r}}function b(){var t=w.apply(this,arguments);return t.sources.forEach(function(n){x(t.target,n,t.deep,!1)}),t.target}function k(t){for(var n=_.keys(t),e=n.length,r=Array(e),i=0;i<e;i++)r[i]=t[n[i]];return r}return e=function(t,n,e,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return!1;if(t!=t)return n!=n;var s=typeof t;return("function"===s||"object"===s||"object"==typeof n)&&r(t,n,e,i)},r=function(t,n,r,i){var s=toString.call(t);if(s!==toString.call(n))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/+t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return m.valueOf.call(t)===m.valueOf.call(n)}var o="[object Array]"===s;if(!o){if("object"!=typeof t||"object"!=typeof n)return!1;var u=t.constructor,h=n.constructor;if(u!==h&&!(a(u)&&u instanceof u&&a(h)&&h instanceof h)&&"constructor"in t&&"constructor"in n)return!1}r=r||[],i=i||[];for(var c=r.length;c--;)if(r[c]===t)return i[c]===n;if(r.push(t),i.push(n),o){if((c=t.length)!==n.length)return!1;for(;c--;)if(!e(t[c],n[c],r,i))return!1}else{var f,l=Object.keys(t);if(c=l.length,Object.keys(n).length!==c)return!1;for(;c--;)if(f=l[c],void 0===n[f]||!e(t[f],n[f],r,i))return!1}return r.pop(),i.pop(),!0},{allKeys:v,clone:function t(n,e){var r;if(void 0===n||null===n)r=n;else if(e&&n.clone)r=n.clone();else if(c(n)){r=[];for(var i=0;i<n.length;i++)r.push(t(n[i]))}else if(h(n))for(var s in r={},n)r[s]=t(n[s]);else r=n;return r},defaults:(d=v,y=!0,function(t){var n=arguments.length;if(y&&(t=Object(t)),n<2||null==t)return t;for(var e=1;e<n;e++)for(var r=arguments[e],i=d(r),s=i.length,o=0;o<s;o++){var a=i[o];y&&void 0!==t[a]||(t[a]=r[a])}return t}),each:function(t,n){var e,r,i,s;if(t)if(void 0===(e=t.length)){for(r in t)if(t.hasOwnProperty(r)&&(s=t[r],!1===n.call(s,r,s)))break}else for(i=0;i<e&&(s=t[i],!1!==n.call(s,i,s));i++);return this},extend:function(t){var n,e=s.call(arguments,1);"boolean"==typeof t&&(n=t,t=e.shift());0==e.length&&(e=[t],t=this);return e.forEach(function(e){b(t,e,n)}),t},has:g,isEqual:function(t,n){return e(t,n)},includes:function(t,n,e,r){t=f(t)?t:k(t),e=e&&!r?p(e):0;var i=t.length;e<0&&(e=nativeMax(i+e,0));return l(t)?e<=i&&t.indexOf(n,e)>-1:!!i&&baseIndexOf(t,n,e)>-1},isMatch:function(t,n){var e=e(n),r=e.length;if(null==t)return!r;for(var i=Object(t),s=0;s<r;s++){var o=e[s];if(n[o]!==i[o]||!(o in i))return!1}return!0},keys:function(t){if(u(t))return[];var n=[];for(var e in t)g(t,e)&&n.push(e);return n},mixin:b,removeItem:function(t,n){if(c(t)){var e=t.indexOf(n);-1!=e&&t.splice(e,1)}else if(h(t))for(var r in t)if(t[r]==n){delete t[r];break}return this},result:function(t,n,e){c(n)||(n=[n]);var r=n.length;if(!r)return a(e)?e.call(t):e;for(var i=0;i<r;i++){var s=null==t?void 0:t[n[i]];void 0===s&&(s=e,i=r),t=a(s)?s.call(t):s}return t},safeMixin:function(){var t=w.apply(this,arguments);return t.sources.forEach(function(n){x(t.target,n,t.deep,!0)}),t.target},values:k}}),define("skylark-langx/klass",["./arrays","./objects","./types"],function(t,n,e){var r=t.uniq,i=n.has,s=n.mixin,o=e.isArray,a=e.isDefined;var u=function(){function t(){return this._construct?this._construct.apply(this,arguments):this.init?this.init.apply(this,arguments):void 0}return function n(u,h,c,f){o(h)&&(f=c,c=h,h=null),h=h||Object,a(c)&&!o(c)&&(f=c,c=!1);var l=h;c&&(c=function(t,n){var e=[];return n.forEach(function(t){if(i(t,"__mixins__"))throw new Error("nested mixins");for(var n=[];t;)n.unshift(t),t=t.superclass;e=e.concat(n)}),(e=(e=r(e)).filter(function(n){for(var e=t;e;){if(n===e)return!1;if(i(e,"__mixins__"))for(var r=e.__mixins__,s=0;s<r.length;s++)if(r[s]===n)return!1;e=e.superclass}return!0})).length>0&&e}(l,c)),c&&(l=function(t,n){for(var e=t,r=0;r<n.length;r++){var i=new Function;i.prototype=Object.create(e.prototype),i.__proto__=e,i.superclass=null,s(i.prototype,n[r].prototype),i.prototype.__mixin__=n[r],e=i}return e}(l,c));var p=u.klassName||"",d=new Function("return function "+p+"() {var inst = this, ctor = arguments.callee;if (!(inst instanceof ctor)) {inst = Object.create(ctor.prototype);}return ctor._constructor.apply(inst, arguments) || inst;}")();return d.prototype=Object.create(l.prototype),d.prototype.constructor=d,d.superclass=h,d.__proto__=l,d._constructor||(d._constructor=t),c&&(d.__mixins__=c),d.partial||(d.partial=function(t,n){return function(t,n,r){var i=t.prototype,s=t.superclass.prototype,o=r&&r.noOverrided;r&&r.overrides;for(var a in n)if("constructor"!==a){var u=n[a];"function"==typeof n[a]?i[a]=u._constructor||o||"function"!=typeof s[a]?u:function(t,n,e){return function(){var t=this.overrided;this.overrided=e;var r=n.apply(this,arguments);return this.overrided=t,r}}(0,u,s[a]):e.isPlainObject(u)&&null!==u&&u.get?Object.defineProperty(i,a,u):i[a]=u}return t}(this,t,n)}),d.inherit||(d.inherit=function(t,e,r){return n(t,this,e,r)}),d.partial(u,f),d}}();return u}),define("skylark-langx/ArrayStore",["./klass"],function(t){var n=function(t){if(!t)return t;var e=!!t.then;function r(r){t[r]=function(){var i=arguments,s=Deferred.when(t,function(t){return n(Array.prototype[r].apply(t,i))});if("forEach"!==r||e)return s}}return e&&(t=Object.delegate(t)),r("forEach"),r("filter"),r("map"),null==t.total&&(t.total=Deferred.when(t,function(t){return t.length})),t},e=t({klassName:"ArrayStore",queryEngine:function(t,n){switch(typeof t){default:throw new Error("Can not query with a "+typeof t);case"object":case"undefined":var e=t;t=function(t){for(var n in e){var r=e[n];if(r&&r.test){if(!r.test(t[n],t))return!1}else if(r!=t[n])return!1}return!0};break;case"string":if(!this[t])throw new Error("No filter function "+t+" was found in store");t=this[t];case"function":}function r(e){var r=function(t,n,e){var r,i=0,s=t&&t.length||0,o=[];s&&"string"==typeof t&&(t=t.split(""));"string"==typeof n&&(n=cache[n]||buildFn(n));if(e)for(;i<s;++i)r=t[i],n.call(e,r,i,t)&&o.push(r);else for(;i<s;++i)r=t[i],n(r,i,t)&&o.push(r);return o}(e,t),i=n&&n.sort;if(i&&r.sort("function"==typeof i?i:function(t,n){for(var e,r=0;e=i[r];r++){var s=t[e.attribute],o=n[e.attribute];if(s=null!=s?s.valueOf():s,o=null!=o?o.valueOf():o,s!=o)return!!e.descending==(null==s||s>o)?-1:1}return 0}),n&&(n.start||n.count)){var s=r.length;(r=r.slice(n.start||0,(n.start||0)+(n.count||1/0))).total=s}return r}return r.matches=t,r},idProperty:"id",get:function(t){return this.data[this.index[t]]},getIdentity:function(t){return t[this.idProperty]},put:function(t,n){var e=this.data,r=this.index,i=this.idProperty,s=t[i]=n&&"id"in n?n.id:i in t?t[i]:Math.random();if(s in r){if(n&&!1===n.overwrite)throw new Error("Object already exists");e[r[s]]=t}else r[s]=e.push(t)-1;return s},add:function(t,n){return(n=n||{}).overwrite=!1,this.put(t,n)},remove:function(t){var n=this.index,e=this.data;if(t in n)return e.splice(n[t],1),this.setData(e),!0},query:function(t,e){return n(this.queryEngine(t,e)(this.data))},setData:function(t){t.items?(this.idProperty=t.identifier||this.idProperty,t=this.data=t.items):this.data=t,this.index={};for(var n=0,e=t.length;n<e;n++)this.index[t[n][this.idProperty]]=n},init:function(t){for(var n in t)this[n]=t[n];this.setData(this.data||[])}});return e}),define("skylark-langx/aspect",[],function(){var t,n=0;function e(e){return function(r,i,s,o){var a,u=r[i];u&&u.target==r||(r[i]=a=function(){for(var e=n,r=arguments,i=a.before;i;)r=i.advice.apply(this,r)||r,i=i.next;if(a.around)var s=a.around.advice(this,r);for(var o=a.after;o&&o.id<e;){if(o.receiveArguments){var u=o.advice.apply(this,r);s=u===t?s:u}else s=o.advice.call(this,s,r);o=o.next}return s},u&&(a.around={advice:function(t,n){return u.apply(t,n)}}),a.target=r);var h=function(t,e,r,i){var s,o=t[e],a="around"==e;if(a){var u=r(function(){return o.advice(this,arguments)});s={remove:function(){u&&(u=t=r=null)},advice:function(t,n){return u?u.apply(t,n):o.advice(t,n)}}}else s={remove:function(){if(s.advice){var n=s.previous,i=s.next;i||n?(n?n.next=i:t[e]=i,i&&(i.previous=n)):delete t[e],t=r=s.advice=null}},id:n++,advice:r,receiveArguments:i};if(o&&!a)if("after"==e){for(;o.next&&(o=o.next););o.next=s,s.previous=o}else"before"==e&&(t[e]=s,s.next=o,o.previous=s);else t[e]=s;return s}(a||u,e,s,o);return s=null,h}}return{after:e("after"),around:e("around"),before:e("before")}}),define("skylark-langx/funcs",["./objects","./types"],function(t,n){var e=t.mixin,r=Array.prototype.slice,i=n.isFunction,s=n.isString;var o=function(){function t(){}return function(n,r){t.prototype=n;var i=new t;return t.prototype=null,r&&e(i,r),i}}();return{debounce:function(t,n){var e;return function(){var r=this,i=arguments;e&&clearTimeout(e),e=setTimeout(function(){e=null,t.apply(r,i)},n)}},delegate:o,defer:function(t){requestAnimationFrame?requestAnimationFrame(t):setTimeoutout(t);return this},noop:function(){},proxy:function t(n,e){var o=2 in arguments&&r.call(arguments,2);if(i(n)){return function(){return n.apply(e,o?o.concat(r.call(arguments)):arguments)}}if(s(e))return o?(o.unshift(n[e],n),t.apply(null,o)):t(n[e],n);throw new TypeError("expected function")},returnTrue:function(){return!0},returnFalse:function(){return!1}}}),define("skylark-langx/Deferred",["./arrays","./funcs","./objects"],function(t,n,e){"use strict";var r=Symbol?Symbol():"__pglisteners",i=Symbol?Symbol():"__pgnotifies",s=Array.prototype.slice,o=n.proxy,a=t.makeArray,u=e.result,h=e.mixin;h(Promise.prototype,{always:function(t){return this.then(t,t),this},done:function(){for(var t=0;t<arguments.length;t++)this.then(arguments[t]);return this},fail:function(t){return this.catch(t),this}});var c=function(){var t=this,n=this.promise=new Promise(function(n,e){t._resolve=n,t._reject=e});f(n,t),this[r]=[],this[i]=[]};function f(t,n){var e={state:function(){return n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},then:function(t,n,e){return e&&this.progress(e),f(Promise.prototype.then.call(this,t&&function(n){return n&&void 0!==n.__ctx__?t.apply(n.__ctx__,n):t(n)},n&&function(t){return t&&void 0!==t.__ctx__?n.apply(t.__ctx__,t):n(t)}))},progress:function(t){return n[i].forEach(function(n){t(n)}),n[r].push(t),this}};return e.pipe=e.then,h(t,e)}return c.prototype.resolve=function(t){var n=s.call(arguments);return this.resolveWith(null,n)},c.prototype.resolveWith=function(t,n){return(n=n?a(n):[]).__ctx__=t,this._resolve(n),this._resolved=!0,this},c.prototype.notify=function(t){try{return this[i].push(t),this[r].forEach(function(n){return n(t)})}catch(t){this.reject(t)}return this},c.prototype.reject=function(t){var n=s.call(arguments);return this.rejectWith(null,n)},c.prototype.rejectWith=function(t,n){return(n=n?a(n):[]).__ctx__=t,this._reject(n),this._rejected=!0,this},c.prototype.isResolved=function(){return!!this._resolved},c.prototype.isRejected=function(){return!!this._rejected},c.prototype.then=function(t,n,e){var r=u(this,"promise");return r.then(t,n,e)},c.prototype.progress=function(t){var n=u(this,"promise");return n.progress(t)},c.prototype.catch=function(t){var n=u(this,"promise");return n.catch(t)},c.prototype.done=function(){var t=u(this,"promise");return t.done.apply(t,arguments)},c.prototype.fail=function(t){var n=u(this,"promise");return n.fail(t)},c.all=function(t){var n=new c;return Promise.all(t).then(n.resolve.bind(n),n.reject.bind(n)),u(n,"promise")},c.first=function(t){return f(Promise.race(t))},c.when=function(t,n,e,r){var i=t&&"function"==typeof t.then,s=i&&t instanceof Promise;if(!i)return arguments.length>1?n?n(t):t:(new c).resolve(t);if(!s){var a=new c(t.cancel);t.then(o(a.resolve,a),o(a.reject,a),a.notify),t=a.promise}return n||e||r?t.then(n,e,r):t},c.reject=function(t){var n=new c;return n.reject(t),n.promise},c.immediate=c.resolve=function(t){var n=new c;return n.resolve.apply(n,arguments),n.promise},c}),define("skylark-langx/async",["./Deferred","./objects"],function(t,n){var e=n.each,r={parallel:function(n,r,i){var s=[];return i=i||null,r=r||[],e(n,function(t,n){s.push(n.apply(i,r))}),t.all(s)},series:function(n,r,i){var s=[],o=new t,a=o.promise;return i=i||null,r=r||[],o.resolve(),e(n,function(t,n){a=a.then(function(){return n.apply(i,r)}),s.push(a)}),t.all(s)},waterful:function(n,r,i){var s=new t,o=s.promise;return i=i||null,r=r||[],s.resolveWith(i,r),e(n,function(t,n){o=o.then(n)}),o}};return r}),define("skylark-langx/datetimes",[],function(){return{parseMilliSeconds:function(t){var n=t.split(" "),e=parseInt(n[0]);if(isNaN(e))return 0;switch(n[1].trim().replace(/\./g,"")){case"minutes":case"minute":case"min":case"mm":case"m":return 6e4*e;case"hours":case"hour":case"HH":case"hh":case"h":case"H":return 36e5*e;case"seconds":case"second":case"sec":case"ss":case"s":return 1e3*e;case"days":case"day":case"DD":case"dd":case"d":return 864e5*e;case"months":case"month":case"MM":case"M":return 24192e5*e;case"weeks":case"week":case"W":case"w":return 6048e5*e;case"years":case"year":case"yyyy":case"yy":case"y":return 31536e6*e;default:return 0}}}}),define("skylark-langx/Evented",["./klass","./arrays","./objects","./types"],function(t,n,e,r){var i=Array.prototype.slice,s=n.compact,o=r.isDefined,a=r.isPlainObject,u=r.isFunction,h=r.isString,c=r.isEmptyObject,f=e.mixin,l=t({on:function(t,n,e,r,i,s){var o=this,c=this._hub||(this._hub={});return a(t)?(i=r,each(t,function(t,r){o.on(t,n,e,r,i,s)}),this):(h(n)||u(r)||(i=r,r=e,e=n,n=void 0),u(e)&&(i=r,r=e,e=null),h(t)&&(t=t.split(/\s/)),t.forEach(function(t){(c[t]||(c[t]=[])).push({fn:r,selector:n,data:e,ctx:i,one:s})}),this)},one:function(t,n,e,r,i){return this.on(t,n,e,r,i,1)},trigger:function(t){if(!this._hub)return this;var n=this;h(t)&&(t=new CustomEvent(t)),Object.defineProperty(t,"target",{value:this});var e=i.call(arguments,1);return e=o(e)?[t].concat(e):[t],[t.type||t.name,"all"].forEach(function(r){var i=n._hub[r];if(i){for(var o=i.length,a=!1,u=0;u<o;u++){var h=i[u];t.data?h.data&&(t.data=f({},h.data,t.data)):t.data=h.data||null,h.fn.apply(h.ctx,e),h.one&&(i[u]=null,a=!0)}a&&(n._hub[r]=s(i))}}),this},listened:function(t){var n=(this._hub||(this._events={}))[t]||[];return n.length>0},listenTo:function(t,n,e,r){if(!t)return this;h(e)&&(e=this[e]),r?t.one(n,e,this):t.on(n,e,this);for(var i,s=this._listeningTo||(this._listeningTo=[]),o=0;o<s.length;o++)if(s[o].obj==t){i=s[o];break}i||s.push(i={obj:t,events:{}});var a=i.events,u=a[n]=a[n]||[];return-1==u.indexOf(e)&&u.push(e),this},listenToOnce:function(t,n,e){return this.listenTo(t,n,e,1)},off:function(t,n){var e=this._hub||(this._hub={});return h(t)&&(t=t.split(/\s/)),t.forEach(function(t){var r=e[t],i=[];if(r&&n)for(var s=0,o=r.length;s<o;s++)r[s].fn!==n&&r[s].fn._!==n&&i.push(r[s]);i.length?e[t]=i:delete e[t]}),this},unlistenTo:function(t,n,e){var r=this._listeningTo;if(!r)return this;for(var i=0;i<r.length;i++){var o=r[i];if(!t||t==o.obj){var a=o.events;for(var u in a)if(!n||n==u){for(var h=a[u],f=0;f<h.length;f++)e&&e!=h[i]||(o.obj.off(u,h[i],this),h[i]=null);h=a[u]=s(h),c(h)&&(a[u]=null)}c(a)&&(r[i]=null)}}return r=this._listeningTo=s(r),c(r)&&(this._listeningTo=null),this}});return l}),define("skylark-langx/hoster",[],function(){var t={isBrowser:!0,isNode:null,global:this,browser:null,node:null};"object"==typeof process&&process.versions&&process.versions.node&&process.versions.v8&&(t.isNode=!0,t.isBrowser=!1),t.global=function(){return"undefined"!=typeof global&&"function"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this}();var n=null;if(Object.defineProperty(t,"document",function(){if(!n){var t="undefined"==typeof window?require("html-element"):window;n=t.document}return n}),t.isBrowser){var e=function(t){t=t.toLowerCase();var n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:n[1]||"",version:n[2]||"0"}}(navigator.userAgent),r=t.browser={};e.browser&&(r[e.browser]=!0,r.version=e.version),r.chrome?r.webkit=!0:r.webkit&&(r.safari=!0)}return t}),define("skylark-langx/strings",[],function(){var t=0;return{camelCase:function(t){return t.replace(/-([\da-z])/g,function(t){return t.toUpperCase().replace("-","")})},dasherize:function(t){return t.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},deserializeValue:function(t){try{return t?"true"==t||"false"!=t&&("null"==t?null:+t+""==t?+t:/^[\[\{]/.test(t)?JSON.parse(t):t):t}catch(n){return t}},lowerFirst:function(t){return t.charAt(0).toLowerCase()+t.slice(1)},serializeValue:function(t){return JSON.stringify(t)},substitute:function(t,n,e,r){function i(t,n){if(t.match(/\./)){var e,r=function(t,n){var i=t.pop();return i?n[i]?r(t,e=n[i]):null:e};return r(t.split(".").reverse(),n)}return n[t]}return r=r||window,e=e?proxy(r,e):function(t){return t},t.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(t,s,o){var a=i(s,n);return o&&(a=i(o,r).call(r,a,s)),e(a,s).toString()})},trim:function(t){return null==t?"":String.prototype.trim.call(t)},uniqueId:function(n){var e=++t+"";return n?n+e:e},upperFirst:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}}}),define("skylark-langx/Xhr",["./arrays","./Deferred","./Evented","./objects","./funcs","./types"],function(arrays,Deferred,Evented,objects,funcs,types){var each=objects.each,mixin=objects.mixin,noop=funcs.noop,isArray=types.isArray,isFunction=types.isFunction,isPlainObject=types.isPlainObject,type=types.type,getAbsoluteUrl=function(t){return a||(a=document.createElement("a")),a.href=t,a.href},a,Xhr=function(){var jsonpID=0,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/,XhrDefaultOptions={async:!0,type:"GET",beforeSend:noop,success:noop,error:noop,complete:noop,context:null,global:!0,accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},crossDomain:!1,timeout:0,processData:!0,cache:!0,xhrFields:{withCredentials:!0}};function mimeToDataType(t){if(t&&(t=t.split(";",2)[0]),t){if(t==htmlType)return"html";if(t==jsonType)return"json";if(scriptTypeRE.test(t))return"script";if(xmlTypeRE.test(t))return"xml"}return"text"}function appendQuery(t,n){return""==n?t:(t+"&"+n).replace(/[&?]{1,2}/,"?")}function serializeData(t){t.data=t.data||t.query,t.processData&&t.data&&"string"!=type(t.data)&&(t.data=param(t.data,t.traditional)),!t.data||t.type&&"GET"!=t.type.toUpperCase()||(t.url=appendQuery(t.url,t.data),t.data=void 0)}function serialize(t,n,e,r){var i,s=isArray(n),o=isPlainObject(n);each(n,function(n,a){i=type(a),r&&(n=e?r:r+"["+(o||"object"==i||"array"==i?n:"")+"]"),!r&&s?t.add(a.name,a.value):"array"==i||!e&&"object"==i?serialize(t,a,e,n):t.add(n,a)})}var param=function(t,n){var e=[];return e.add=function(t,n){isFunction(n)&&(n=n()),null==n&&(n=""),this.push(escape(t)+"="+escape(n))},serialize(e,t,n),e.join("&").replace(/%20/g,"+")},Xhr=Evented.inherit({klassName:"Xhr",_request:function(args){var _=this._,self=this,options=mixin({},XhrDefaultOptions,_.options,args),xhr=_.xhr=new XMLHttpRequest;serializeData(options);var dataType=options.dataType||options.handleAs,mime=options.mimeType||options.accepts[dataType],headers=options.headers,xhrFields=options.xhrFields,isFormData=options.data&&options.data instanceof FormData,basicAuthorizationToken=options.basicAuthorizationToken,type=options.type,url=options.url,async=options.async,user=options.user,password=options.password,deferred=new Deferred,contentType=!isFormData&&"application/x-www-form-urlencoded";if(xhrFields)for(name in xhrFields)xhr[name]=xhrFields[name];mime&&mime.indexOf(",")>-1&&(mime=mime.split(",",2)[0]),mime&&xhr.overrideMimeType&&xhr.overrideMimeType(mime);var finish=function(){xhr.onloadend=noop,xhr.onabort=noop,xhr.onprogress=noop,xhr.ontimeout=noop,xhr=null},onloadend=function(){var result,error=!1;if(xhr.status>=200&&xhr.status<300||304==xhr.status||0==xhr.status&&getAbsoluteUrl(url).startsWith("file:")){dataType=dataType||mimeToDataType(options.mimeType||xhr.getResponseHeader("content-type")),result=xhr.responseText;try{"script"==dataType?eval(result):"xml"==dataType?result=xhr.responseXML:"json"==dataType?result=blankRE.test(result)?null:JSON.parse(result):"blob"==dataType?result=Blob([xhrObj.response]):"arraybuffer"==dataType&&(result=xhr.reponse)}catch(t){error=t}error?deferred.reject(error,xhr.status,xhr):deferred.resolve(result,xhr.status,xhr)}else deferred.reject(new Error(xhr.statusText),xhr.status,xhr);finish()},onabort=function(){deferred&&deferred.reject(new Error("abort"),xhr.status,xhr),finish()},ontimeout=function(){deferred&&deferred.reject(new Error("timeout"),xhr.status,xhr),finish()},onprogress=function(t){deferred&&deferred.notify(t,xhr.status,xhr)};if(xhr.onloadend=onloadend,xhr.onabort=onabort,xhr.ontimeout=ontimeout,xhr.onprogress=onprogress,xhr.open(type,url,async,user,password),headers)for(var key in headers){var value=headers[key];"content-type"===key.toLowerCase()?contentType=headers[hdr]:xhr.setRequestHeader(key,value)}return contentType&&!1!==contentType&&xhr.setRequestHeader("Content-Type",contentType),headers&&"X-Requested-With"in headers||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),basicAuthorizationToken&&xhr.setRequestHeader("Authorization",basicAuthorizationToken),xhr.send(options.data?options.data:null),deferred.promise},abort:function(){var t=this._,n=t.xhr;n&&n.abort()},request:function(t){return this._request(t)},get:function(t){return(t=t||{}).type="GET",this._request(t)},post:function(t){return(t=t||{}).type="POST",this._request(t)},patch:function(t){return(t=t||{}).type="PATCH",this._request(t)},put:function(t){return(t=t||{}).type="PUT",this._request(t)},del:function(t){return(t=t||{}).type="DELETE",this._request(t)},init:function(t){this._={options:t||{}}}});return["request","get","post","put","del","patch"].forEach(function(t){Xhr[t]=function(n,e){var r=new Xhr({url:n});return r[t](e)}}),Xhr.defaultOptions=XhrDefaultOptions,Xhr.param=param,Xhr}();return Xhr}),define("skylark-langx/Restful",["./Evented","./objects","./strings","./Xhr"],function(t,n,e,r){var i=n.mixin,s=e.substitute,o=t.inherit({klassName:"Restful",idAttribute:"id",getBaseUrl:function(t){var n=s(this.baseEndpoint,t),e=this.server+this.basePath+n;return void 0!==t[this.idAttribute]&&(e=e+"/"+t[this.idAttribute]),e},_head:function(t){},_get:function(t){return r.get(this.getBaseUrl(t),t)},_post:function(t,n){var e=this.getBaseUrl(t);return n&&(e=e+"/"+n),r.post(e,t)},_put:function(t,n){var e=this.getBaseUrl(t);return n&&(e=e+"/"+n),r.put(e,t)},_delete:function(t){var n=this.getBaseUrl(t);return r.del(n)},_patch:function(t){var n=this.getBaseUrl(t);return r.patch(n,t)},query:function(t){return this._post(t)},retrieve:function(t){return this._get(t)},create:function(t){return this._post(t)},update:function(t){return this._put(t)},delete:function(t){return this._delete(t)},patch:function(t){return this._patch(t)},init:function(t){i(this,t)}});return o}),define("skylark-langx/Stateful",["./Evented","./strings","./objects"],function(t,n,e){var r=e.isEqual,i=e.mixin,s=e.result,o=e.isEmptyObject,a=e.clone,u=n.uniqueId,h=t.inherit({_construct:function(t,n){var e=t||{};n||(n={}),this.cid=u(this.cidPrefix),this.attributes={},n.collection&&(this.collection=n.collection),n.parse&&(e=this.parse(e,n)||{});var r=s(this,"defaults");e=i({},r,e),this.set(e,n),this.changed={}},changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",toJSON:function(t){return a(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return null!=this.get(t)},set:function(t,n,e){if(null==t)return this;var i;if("object"==typeof t?(i=t,e=n):(i={})[t]=n,e||(e={}),!this._validate(i,e))return!1;var s=e.unset,o=e.silent,u=[],h=this._changing;this._changing=!0,h||(this._previousAttributes=a(this.attributes),this.changed={});var c=this.attributes,f=this.changed,l=this._previousAttributes;for(var p in i)n=i[p],r(c[p],n)||u.push(p),r(l[p],n)?delete f[p]:f[p]=n,s?delete c[p]:c[p]=n;if(this.idAttribute in i&&(this.id=this.get(this.idAttribute)),!o){u.length&&(this._pending=e);for(var d=0;d<u.length;d++)this.trigger("change:"+u[d],this,c[u[d]],e)}if(h)return this;if(!o)for(;this._pending;)e=this._pending,this._pending=!1,this.trigger("change",this,e);return this._pending=!1,this._changing=!1,this},unset:function(t,n){return this.set(t,void 0,i({},n,{unset:!0}))},clear:function(t){var n={};for(var e in this.attributes)n[e]=void 0;return this.set(n,i({},t,{unset:!0}))},hasChanged:function(t){return null==t?!o(this.changed):void 0!==this.changed[t]},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&a(this.changed);var n=this._changing?this._previousAttributes:this.attributes,e={};for(var i in t){var s=t[i];r(n[i],s)||(e[i]=s)}return!o(e)&&e},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return a(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i({},t,{validate:!0}))},_validate:function(t,n){if(!n.validate||!this.validate)return!0;t=i({},this.attributes,t);var e=this.validationError=this.validate(t,n)||null;return!e||(this.trigger("invalid",this,e,i(n,{validationError:e})),!1)}});return h}),define("skylark-langx/langx",["./skylark","./arrays","./ArrayStore","./aspect","./async","./datetimes","./Deferred","./Evented","./funcs","./hoster","./klass","./numbers","./objects","./Restful","./Stateful","./strings","./types","./Xhr"],function(t,n,e,r,i,s,o,a,u,h,c,f,l,p,d,y,m,v){"use strict";Array.prototype.concat,Array.prototype.indexOf,Array.prototype.slice,Array.prototype.filter;var g=l.mixin,x=l.safeMixin,_=m.isFunction;var w=1;function b(){return b}return g(b,{createEvent:function(t,n){var e=new CustomEvent(t,n);return x(e,n)},funcArg:function(t,n,e,r){return _(n)?n.call(t,e,r):n},getQueryParams:function(t){var n=(t=t||window.location.href).split("?"),e={};n.length>1&&n[1].split("&").forEach(function(t){var n=t.split("=");e[n[0]]=n[1]});return e},toPixel:function(t){return parseFloat(t)||0},uid:function(t){return t._uid||(t._uid=w++)},URL:"undefined"!=typeof window?window.URL||window.webkitURL:null}),g(b,n,r,s,u,f,l,y,m,{ArrayStore:e,async:i,Deferred:o,Evented:a,hoster:h,klass:c,Restful:p,Stateful:d,Xhr:v}),t.langx=b}),define("skylark-utils-math/math",["skylark-langx/skylark","skylark-langx/langx"],function(t,n){var e=t.math={log2:function(t){for(var n=1,e=0;t>n;)n<<=1,e++;return e}};return n.mixin(e,Math),e}),define("skylark-utils-math/Geometry",["skylark-langx/langx","./math"],function(t,n){var e=n.Geometry=t.klass({klassName:"Geometry"});return e}),define("skylark-utils-math/Point",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.Point=e.inherit({klassName:"Point",x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},clone:function(){var t=this._;return new r(t.x,t.y)},move:function(t,n){var e=this._;return new r(e.x+t,e.y+n)},notEqual:function(t){var n=this._;return!t||t.x!=n.x||t.y!=n.y},equal:function(t){return!this.notEqual(t)},init:function(t,n){var e=this._={};e.x=t||0,e.y=n||0}});return r.fromString=function(t){var n=t.split(",");return new r(parseFloat(n[0]),parseFloat(n[1]))},r.fromPlain=function(t){return new r(t.x,t.y)},r.fromArray=function(t){return new r(t[0],t[1])},r.Zero=new r(0,0),r}),define("skylark-utils-math/Arrow",["skylark-langx/langx","./math","./Geometry","./Point"],function(t,n,e,r){var i={left:1,top:2,right:3,bottom:4},s=n.Arrow=e.inherit({klassName:"Arrow",bounds:{get:function(){var t=this._,n={x:t.x,y:this.y,width:t.width,height:t.height};return n}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},direction:{get:function(){return this._.direction}},leftTop:{get:function(){var t=this._;return new r(t.x,t.y)}},leftBottom:{get:function(){var t=this._;return new r(t.x,t.y+t.height)}},rightTop:{get:function(){var t=this._;return new r(t.x+t.width,t.y)}},rightBottom:{get:function(){var t=this._;return new r(t.x+t.width,t.y+t.height)}},move:function(t,n){var e=this._;return new s(e.x+t,e.y+n,e.width,e.height,e.direction)},containPoint:function(t,n){if(void 0===n){var e=t;t=e.x,n=e.y}var r=this._;return t>=r.x&&t<r.x+r.width&&n>=r.y&&n<r.y+r.height},init:function(t,n,e,r,s){var o=this._={};o.x=t||0,o.y=n||0,o.width=e||0,o.height=r||0,o.direction=s||i.top}});return s.Direction=i,s}),define("skylark-utils-math/Circle",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.Circle=e.inherit({klassName:"Circle",bounds:{get:function(){var t=this._,n={x:t.cx-t.r,y:t.cy-t.r,width:2*t.r,height:2*t.r};return n}},cx:{get:function(){return this._.cx}},cy:{get:function(){return this._.cy}},r:{get:function(){return this._.r}},move:function(t,n){var e=this._;return new r(e.cx+t,e.cy+n,e.r)},containPoint:function(t,n){if(void 0===n){var e=t;t=e.x,n=e.y}var r=this._,i=(t-r.x)*(t-r.x)+(n-r.y)*(n-r.y);return i<r.r*r.r},init:function(t,n,e){var r=this._={};r.cx=t||0,r.cy=n||0,r.r=e||0}});return r}),define("skylark-utils-math/Ellipse",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.Ellipse=e.inherit({klassName:"Ellipse",bounds:{get:function(){var t=this._,n={x:t.cx-t.rx,y:t.cy-t.ry,width:2*t.rx,height:2*t.ry};return n}},cx:{get:function(){return this._.cx}},cy:{get:function(){return this._.cy}},rx:{get:function(){return this._.rx}},ry:{get:function(){return this._.ry}},move:function(t,n){var e=this._;return new r(e.cx+t,e.cy+n,e.rx,e.ry)},containPoint:function(t){},init:function(t,n,e,r){var i=this._={};i.cx=t||0,i.cy=n||0,i.rx=e||0,i.ry=r||0}});return r}),define("skylark-utils-math/Line",["skylark-langx/langx","./math","./Geometry","./Point"],function(t,n,e,r){var i=n.Line=e.inherit({klassName:"Line",bounds:{get:function(){var t=this._,n={x:Math.min(t.x1,t.x2),y:Math.min(t.y1,t.y2),width:Math.abs(t.x2-t.x1),height:Math.abs(t.y2-t.y1)};return n}},x1:{get:function(){return this._.x1}},y1:{get:function(){return this._.y1}},x2:{get:function(){return this._.x2}},y2:{get:function(){return this._.y2}},startPoint:{get:function(){var t=this._;return new r(t.x1,t.y1)}},endPointer:{get:function(){var t=this._;return new r(t.x2,t.y2)}},move:function(t,n){var e=this._;return new i(e.x1+t,e.y1+n,e.x2+t,e.y2+n)},containPoint:function(t,n){if(void 0===n){var e=t;t=e.x,n=e.y}var r=this._;return Math.abs((n-r.y1)*(r.x2-r.x1)-(r.y2-r.y1)*(t-r.x1))<1e-6},init:function(t,n,e,r){var i=this._={};i.x1=t||0,i.y1=n||0,i.x2=e||0,i.y2=r||0}});return i}),define("skylark-utils-math/Polyline",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.Polyline=e.inherit({klassName:"Polyline",bounds:{get:function(){for(var t=this._,n=t.points,e=n.length,r=n[0],i={l:r.x,t:r.y,r:r.x,b:r.y},s=1;s<e;++s)r=n[s],i.l>r.x&&(i.l=r.x),i.r<r.x&&(i.r=r.x),i.t>r.y&&(i.t=r.y),i.b<r.y&&(i.b=r.y);var o={x:i.l,y:i.t,width:i.r-i.l,height:i.b-i.t};return o}},points:{get:function(){return this._.points}},init:function(t){var n=this._={};n.points=t||[]}});return r}),define("skylark-utils-math/PolyStar",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.PolyStar=e.inherit({klassName:"PolyStar",bounds:{get:function(){var t=this._,n=t.points,e=n.length,r=n[0];bbox={l:r.x,t:r.y,r:r.x,b:r.y};for(var i=1;i<e;++i)r=n[i],bbox.l>r.x&&(bbox.l=r.x),bbox.r<r.x&&(bbox.r=r.x),bbox.t>r.y&&(bbox.t=r.y),bbox.b<r.y&&(bbox.b=r.y);var s={x:bbox.l,y:bbox.t,width:bbox.r-bbox.l,height:bbox.b-bbox.t};return s}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},radius:{get:function(){return this._.radius}},sides:{get:function(){return this._.sides}},pointSize:{get:function(){return this._.pointSize}},angle:{get:function(){return this._.angle}},init:function(t,n,e,r,i,s){var o=this._;o.x=t,o.y=n,o.radius=e,o.sides=r,o.pointSize=i,o.angle=s}});return r}),define("skylark-utils-math/Size",["skylark-langx/langx","./math","./Geometry"],function(t,n,e){var r=n.Size=e.inherit({klassName:"Size",width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},clone:function(){var t=this._;return new r(t.width,t.height)},toArray:function(){return[this.width,this.height]},toPlain:function(){return{width:this.width,height:this.height}},toString:function(){return this.width+","+this.height},init:function(t,n){var e=this._={};e.width=t||0,e.height=n||0}});return r.fromString=function(t){var n=t.split(",");return new r(parseFloat(n[0]),parseFloat(n[1]))},r.fromPlain=function(t){return new r(t.w||t.width,t.h||t.height)},r.fromArray=function(t){return new r(t[0],t[1])},r.Zero=new r(0,0),r}),define("skylark-utils-math/Rect",["skylark-langx/langx","./math","./Geometry","./Point","./Size"],function(t,n,e,r,i){var s=n.Rect=e.inherit({klassName:"Rect",bounds:{get:function(){var t=this._,n={x:t.x,y:this.y,width:t.width,height:t.height};return n}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},width:{get:function(){return this._.width}},height:{get:function(){return this._.height}},radius:{get:function(){return this._.radius}},leftTop:{get:function(){var t=this._;return new r(t.x,t.y)}},leftBottom:{get:function(){var t=this._;return new r(t.x,t.y+t.height)}},rightTop:{get:function(){var t=this._;return new r(t.x+t.width,t.y)}},rightBottom:{get:function(){var t=this._;return new r(t.x+t.width,t.y+t.height)}},size:{get:function(){var t=this._;return new i(t.width,t.height)}},move:function(t,n){var e=this._;return new s(e.x+t,e.y+n,e.width,e.height,e.radius)},containPoint:function(t,n){if(void 0===n){var e=t;t=e.x,n=e.y}var r=this._;return t>=r.x&&t<r.x+r.width&&n>=r.y&&n<r.y+r.height},isEmpty:function(){return this.width<=0||this.height<=0},notEqual:function(t){return!t||t.x!=this.x||t.y!=this.y||t.width!=this.width||t.height!=this.height||t.radius!=this.radius},equal:function(t){return!this.notEqual(t)},isIntersect:function(t,n,e,r){var i=this.x1,s=this.y,o=this.width,a=this.height;return Math.min(i+o,t+e)-(i>t?i:t)>0&&Math.min(s+a,n+r)-(s>n?s:n)>0},intersect:function(t,n,e,r){var i=this.x1,s=this.y,o=this.width,a=this.height;return Math.min(i+o,t+e)-(i>t?i:t)>0&&Math.min(s+a,n+r)-(s>n?s:n)>0},unite:function(t,n,e,r){var i=this.x1,o=this.y,a=this.width,u=this.height,h=i<t?i:t,c=o<n?o:n,f=Math.max(i+a,t+e)-h;return height=Math.max(o+u,n+r)-c,new s(h,c,f,height)},clone:function(){var t=this._;return new s(t.x,t.y,t.width,t.height,t.radius)},init:function(t,n,e,r,i){var s=this._={};s.x=t||0,s.y=n||0,s.width=e||0,s.height=r||0,s.radius=i||0}});return s.fromString=function(t){var n=t.split(",");return new s(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))},s.fromPlain=function(t){return new s(t.x||t.l,t.y||t.t,t.w||t.width,t.h||t.height)},s.fromArray=function(t){return new s(t[0],t[1],t[2],t[3])},s.Zero=new s(0,0,0,0),s}),define("skylark-utils-math/transform/Matrix",["skylark-langx/langx","../math"],function(t,n){var e=Math.PI/180,r={},i=function(t){return r[t]||(r[t]=Math.PI*t/180)},s=n.TransformMatrix=t.klass({klassName:"TransformMatrix",_multiplyPoint:function(t){var n=this._,e=t.x*n.m11+t.y*n.m21+n.dx,r=t.x*n.m12+t.y*n.m22+n.dy;return new Point(e,r)},m11:{get:function(){return this._.m11}},m12:{get:function(){return this._.m12}},m21:{get:function(){return this._.m21}},m22:{get:function(){return this._.m22}},dx:{get:function(){return this._.dx}},dy:{get:function(){return this._.dy}},alpha:{get:function(){return this._.alpha}},shadow:{get:function(){return this._.shadow}},compositeOperation:{get:function(){return this._.compositeOperation}},multiplyPoint:function(t){return this._multiplyPoint(t)},multiplyRectangle:function(t){if(this.isIdentity())return t.clone();var n=this.multiplyPoint(t.leftTop),e=this.multiplyPoint(t.leftBottom),r=this.multiplyPoint(t.right),i=this.multiplyPoint(t.rightBottom),s=Math.min(n.x,e.x,r.x,i.x),o=Math.min(n.y,e.y,r.y,i.y),a=Math.max(n.x,e.x,r.x,i.x),u=Math.max(n.y,e.y,r.y,i.y);return new Rect(s,o,a-s,u-o)},prepend:function(t,n,e,r,i,s){var o=this.dx;if(1!=t||0!=n||0!=e||1!=r){var a=this.m11,u=this.m21;this.m11=a*t+this.m12*e,this.m12=a*n+this.m12*r,this.m21=u*t+this.m22*e,this.m22=u*n+this.m22*r}return this.dx=o*t+this.dy*e+i,this.dy=o*n+this.dy*r+s,this},append:function(t,n,e,r,i,s){var o=this.m11,a=this.m12,u=this.m21,h=this.m22;return this.m11=t*o+n*u,this.m12=t*a+n*h,this.m21=e*o+r*u,this.m22=e*a+r*h,this.dx=i*o+s*u+this.dx,this.dy=i*a+s*h+this.dy,this},prependMatrix:function(t){return this.prepend(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.prependProperties(t.alpha,t.shadow,t.compositeOperation),this},appendMatrix:function(t){return this.append(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),this.appendProperties(t.alpha,t.shadow,t.compositeOperation),this},prependTransform:function(t,n,r,i,s,o,a,u,h){if(s%360)var c=s*e,f=Math.cos(c),l=Math.sin(c);else f=1,l=0;return(u||h)&&(this.dx-=u,this.dy-=h),o||a?(o*=e,a*=e,this.prepend(f*r,l*r,-l*i,f*i,0,0),this.prepend(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,n)):this.prepend(f*r,l*r,-l*i,f*i,t,n),this},appendTransform:function(t,n,r,i,s,o,a,u,h){if(s%360)var c=s*e,f=Math.cos(c),l=Math.sin(c);else f=1,l=0;return o||a?(o*=e,a*=e,this.append(Math.cos(a),Math.sin(a),-Math.sin(o),Math.cos(o),t,n),this.append(f*r,l*r,-l*i,f*i,0,0)):this.append(f*r,l*r,-l*i,f*i,t,n),(u||h)&&(this.dx-=u*this.m11+h*this.m21,this.dy-=u*this.m12+h*this.m22),this},rotate:function(t){var n=Math.cos(t),e=Math.sin(t),r=this.m11,i=this.m21,s=this.dx;return this.m11=r*n-this.m12*e,this.m12=r*e+this.m12*n,this.m21=i*n-this.m22*e,this.m22=i*e+this.m22*n,this.dx=s*n-this.dy*e,this.dy=s*e+this.dy*n,this},skew:function(t,n){return t*=e,n*=e,this.append(Math.cos(n),Math.sin(n),-Math.sin(t),Math.cos(t),0,0),this},scale:function(t,n){return this.m11*=t,this.m22*=n,this.dx*=t,this.dy*=n,this},translate:function(t,n){return this.dx+=t,this.dy+=n,this},identity:function(){return this.alpha=this.m11=this.m22=1,this.m12=this.m21=this.dx=this.dy=0,this.shadow=this.compositeOperation=null,this},invert:function(){var t=this.m11,n=this.m12,e=this.m21,r=this.m22,i=this.dx,s=t*r-n*e;return this.m11=r/s,this.m12=-n/s,this.m21=-e/s,this.m22=t/s,this.dx=(e*this.dy-r*i)/s,this.dy=-(t*this.dy-n*i)/s,this},isIdentity:function(){return 0==this.dx&&0==this.dy&&1==this.m11&&0==this.m12&&0==this.m21&&1==this.m22},decompose:function(t){null==t&&(t={}),t.x=this.dx,t.y=this.dy,t.scaleX=Math.sqrt(this.m11*this.m11+this.m12*this.m12),t.scaleY=Math.sqrt(this.m21*this.m21+this.m22*this.m22);var n=Math.atan2(-this.m21,this.m22),r=Math.atan2(this.m12,this.m11);return n==r?(t.rotation=r/e,this.m11<0&&this.m22>=0&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=n/e,t.skewY=r/e),t},reinitialize:function(t,n,e,r,i,s,o,a,u){return this._initialize(t,n,e,r,i,s),this.alpha=o||1,this.shadow=a,this.compositeOperation=u,this},appendProperties:function(t,n,e){return this.alpha*=t,this.shadow=n||this.shadow,this.compositeOperation=e||this.compositeOperation,this},prependProperties:function(t,n,e){return this.alpha*=t,this.shadow=this.shadow||n,this.compositeOperation=this.compositeOperation||e,this},multiply:function(t){var n=this.m11,e=this.m12,r=this.m21,i=this.m22,s=this.dx,o=this.dy,a=t;return this.m11=n*a.m11+r*a.m12,this.m12=e*a.m11+i*a.m12,this.m21=n*a.m21+r*a.m22,this.m22=e*a.m21+i*a.m22,this.dx=n*a.dx+r*a.dy+s,this.dy=e*a.dx+i*a.dy+o,this},clone:function(){var t=this._,n=new s(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy);return n.shadow=this.shadow,n.alpha=this.alpha,n.compositeOperation=this.compositeOperation,n},toString:function(){var t=this._;return"[Matrix (m11="+t.m11+" m12="+t.m12+" m21="+t.m21+" m22="+t.m22+" dx="+t.dx+" dy="+t.dy+")]"},init:function(t,n,e,r,i,s){var o=this._;o.m11=t||1,o.m12=n||0,o.m21=e||0,o.m22=r||1,o.dx=i||0,o.dy=s||0}});return t.mixin(s,{translate:function(t,n){return new s(1,0,0,1,t,n)},scale:function(t,n){return new s(t,0,0,n||t,0,0)},rotate:function(t){var n=Math.cos(t),e=Math.sin(t);return new s(n,e,-e,n,0,0)},rotateg:function(t){return this.rotate(i(t))},skewX:function(t){var n=Math.tan(t);return new s(1,0,n,1)},skewXg:function(t){return this.skewX(i(t))},skewY:function(t){var n=Math.tan(t);return new s(1,n,0,1)},skewYg:function(t){return this.skewY(i(t))},reflect:function(t,n){1==arguments.length&&(n=t.y,t=t.x);var e=t*t,r=n*n,i=e+r,o=2*e/i-1,a=2*t*n/i,u=a,h=2*r/i-1;return new s(o,u,a,h)},project:function(t,n){var e=t*t,r=n*n,i=e+r,o=e/i,a=t*n/i;return yx=a,yy=r/i,new s(o,yx,a,yy)},_sandwich:function(t,n,e){return this.translate(n,e).multiply(t).multiply(this.translate(-n,-e))},scaleAt:function(t,n,e,r){switch(arguments.length){case 4:return this._sandwich(this.scale(t,n),e,r);case 3:return"number"==typeof e?this._sandwich(this.scale(t),n,e):this._sandwich(this.scale(t,n),e.x,e.y)}return this._sandwich(this.scale(t),n.x,n.y)},rotateAt:function(t,n,e){return arguments.length>2?this._sandwich(this.rotate(t),n,e):this._sandwich(this.rotate(t),n.x,n.y)},rotategAt:function(t,n,e){return arguments.length>2?this._sandwich(this.rotateg(t),n,e):this._sandwich(this.rotateg(t),n.x,n.y)},skewXAt:function(t,n,e){return arguments.length>2?this._sandwich(this.skewX(t),n,e):this._sandwich(this.skewX(t),n.x,n.y)},skewXgAt:function(t,n,e){return arguments.length>2?this._sandwich(this.skewXg(t),n,e):this._sandwich(this.skewXg(t),n.x,n.y)},skewYAt:function(t,n,e){return arguments.length>2?this._sandwich(this.skewY(t),n,e):this._sandwich(this.skewY(t),n.x,n.y)},skewYgAt:function(t,n,e){return arguments.length>2?this._sandwich(this.skewYg(t),n,e):this._sandwich(this.skewYg(t),n.x,n.y)}}),s}),define("skylark-utils-math/transform/Transform",["skylark-langx/langx","../math","./Matrix"],function(t,n,e){var r=n.Transform=t.klass({klassName:"Transform",value:{get:function(){return this._.value}}});return r}),define("skylark-utils-math/transform/MatrixTransform",["skylark-langx/langx","../math","./Transform","../Point","../Rect"],function(t,n,e,r,i){var s=n.MatrixTransform=e.inherit({klassName:"MatrixTransform",value:{get:function(){return this.matrix.clone()}},matrix:{get:function(){return this._.matrix}},clone:function(){},transform:function(t){},transformBounds:function(t){},initialize:function(t){var n=this._;n.matrix=t}});return s}),define("skylark-utils-math/transform/RotateTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,e,r,i,s){var o=n.RotateTransform=e.inherit({klassName:"RotateTransform",value:{get:function(){return r.rotateAt(this.angle,this.centerX,this.centerY)}},angle:{get:function(){return this._.angle}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n,e){var r=this._={};r.angle=t||0,r.centerX=n||0,r.centerY=e||0}});return o}),define("skylark-utils-math/transform/ScaleTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,e,r,i,s){var o=n.ScaleTransform=e.inherit({klassName:"ScaleTransform",value:{get:function(){return r.scaleAt(this.scaleX,this.scaleY,this.centerX,this.centerY)}},scaleX:{get:function(){return this._.scaleX}},scaleY:{get:function(){return this._.scaleY}},centerX:{get:function(){return this._.centerX}},centerY:{get:function(){return this._.centerY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n,e,r){var i=this._;i.scaleX=t||1,i.scaleY=n||1,i.centerX=e||0,i.centerY=r||0}});return o}),define("skylark-utils-math/transform/SkewTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,e,r,i){var s=math.SkewTransform=n.inherit({klassName:"SkewTransform",value:{get:function(){return e.scaleAt(this.skewX,this.skewY)}},skewX:{get:function(){return this._.skewX}},skewY:{get:function(){return this._.skewY}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n){var e=this._;e.skewX=t||0,e.skewY=n||0}});return s}),define("skylark-utils-math/transform/TranslateTransform",["skylark-langx/langx","../math","./Transform","./Matrix","../Point","../Rect"],function(t,n,e,r,i,s){var o=n.TranslateTransform=e.inherit({klassName:"TranslateTransform",value:{get:function(){return r.scaleAt(this.x,this.y)}},x:{get:function(){return this._.x}},y:{get:function(){return this._.y}},clone:function(){},transform:function(t){},transformBounds:function(t){},init:function(t,n){var e=this._;e.x=t||0,e.y=n||0}});return o}),define("skylark-utils-math/main",["./math","./Arrow","./Circle","./Ellipse","./Geometry","./Line","./Point","./Polyline","./PolyStar","./Rect","./Size","./transform/Matrix","./transform/MatrixTransform","./transform/RotateTransform","./transform/ScaleTransform","./transform/SkewTransform","./transform/Transform","./transform/TranslateTransform"],function(t){return t}),define("skylark-utils-math",["skylark-utils-math/main"],function(t){return t})}(define,require),!isAmd){var skylarkjs=require("skylark-langx/skylark");isCmd?module.exports=skylarkjs:globals.skylarkjs=skylarkjs}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-utils-math-all.js.map
